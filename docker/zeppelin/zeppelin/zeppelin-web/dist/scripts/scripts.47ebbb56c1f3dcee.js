"use strict";!function(){function a(){var a=angular.injector(["ng"]).get("$http"),b=angular.injector(["zeppelinWebApp"]).get("baseUrlSrv");return a.defaults.withCredentials=!0,jQuery.ajaxSetup({dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}),a.get(b.getRestApiBase()+"/security/ticket").then(function(a){c.run(["$rootScope",function(b){b.ticket=angular.fromJson(a.data).body}])},function(a){})}function b(){c.run(["$rootScope","$location",function(a,b){a.$on("$routeChangeStart",function(c,d,e){a.ticket||!d.$$route||d.$$route.publicAccess||b.path("/")})}]),angular.bootstrap(document,["zeppelinWebApp"])}var c=angular.module("zeppelinWebApp",["ngCookies","ngAnimate","ngRoute","ngSanitize","angular-websocket","ui.ace","ui.bootstrap","as.sortable","ngTouch","ngDragDrop","angular.filter","monospaced.elastic","puElasticInput","xeditable","ngToast","focus-if","ngResource","esri.map"]).filter("breakFilter",function(){return function(a){if(a)return a.replace(/\n/g,"<br />")}}).config(["$httpProvider","$routeProvider","ngToastProvider",function(a,b,c){a.defaults.withCredentials=!0,b.when("/",{templateUrl:"app/home/home.html"}).when("/notebook/:noteId",{templateUrl:"app/notebook/notebook.html",controller:"NotebookCtrl"}).when("/notebook/:noteId/paragraph?=:paragraphId",{templateUrl:"app/notebook/notebook.html",controller:"NotebookCtrl"}).when("/notebook/:noteId/paragraph/:paragraphId?",{templateUrl:"app/notebook/notebook.html",controller:"NotebookCtrl"}).when("/jobmanager",{templateUrl:"app/jobmanager/jobmanager.html",controller:"JobmanagerCtrl"}).when("/interpreter",{templateUrl:"app/interpreter/interpreter.html",controller:"InterpreterCtrl"}).when("/credential",{templateUrl:"app/credential/credential.html",controller:"CredentialCtrl"}).when("/configuration",{templateUrl:"app/configuration/configuration.html",controller:"ConfigurationCtrl"}).when("/search/:searchTerm",{templateUrl:"app/search/result-list.html",controller:"SearchResultCtrl"}).otherwise({redirectTo:"/"}),c.configure({dismissButton:!0,dismissOnClick:!1,timeout:6e3})}]);angular.element(document).ready(function(){a().then(b)})}(),angular.module("zeppelinWebApp").controller("MainCtrl",["$scope","$rootScope","$window","arrayOrderingSrv",function(a,b,c,d){a.looknfeel="default";var e=function(){a.asIframe=c.location.href.indexOf("asIframe")>-1};e(),b.$on("setIframe",function(b,c){b.defaultPrevented||(a.asIframe=c,b.preventDefault())}),b.$on("setLookAndFeel",function(b,c){!b.defaultPrevented&&c&&""!==c&&c!==a.looknfeel&&(a.looknfeel=c,b.preventDefault())}),b.$on("$routeChangeStart",function(a,c,d){b.$broadcast("setLookAndFeel","default")}),b.noteName=function(a){if(!_.isEmpty(a))return d.getNoteName(a)},BootstrapDialog.defaultOptions.onshown=function(){angular.element("#"+this.id).find(".btn:last").focus()},BootstrapDialog.configDefaultOptions({animate:!1})}]),angular.module("zeppelinWebApp").controller("HomeCtrl",["$scope","notebookListDataFactory","websocketMsgSrv","$rootScope","arrayOrderingSrv",function(a,b,c,d,e){var f=this;f.notes=b,f.websocketMsgSrv=c,f.arrayOrderingSrv=e,f.notebookHome=!1,void 0!==d.ticket?f.staticHome=!1:f.staticHome=!0,a.isReloading=!1;var g=function(){c.getHomeNotebook()};g(),a.reloadNotebookList=function(){c.reloadAllNotesFromRepo(),a.isReloadingNotes=!0},a.toggleFolderNode=function(a){a.hidden=!a.hidden},angular.element("#loginModal").on("hidden.bs.modal",function(a){d.$broadcast("initLoginValues")}),a.$on("setNoteMenu",function(b,c){a.isReloadingNotes=!1}),a.$on("setNoteContent",function(a,b){b?(f.note=b,d.$broadcast("setLookAndFeel","home"),f.viewOnly=!0,f.notebookHome=!0,f.staticHome=!1):(f.staticHome=!0,f.notebookHome=!1)})}]),angular.module("zeppelinWebApp").controller("NotebookCtrl",["$scope","$route","$routeParams","$location","$rootScope","$http","websocketMsgSrv","baseUrlSrv","$timeout","saveAsService",function(a,b,c,d,e,f,g,h,i,j){function k(){a.permissions.owners=angular.element("#selectOwners").val(),a.permissions.readers=angular.element("#selectReaders").val(),a.permissions.writers=angular.element("#selectWriters").val()}a.note=null,a.moment=moment,a.editorToggled=!1,a.tableToggled=!1,a.viewOnly=!1,a.showSetting=!1,a.looknfeelOption=["default","simple","report"],a.cronOption=[{name:"None",value:void 0},{name:"1m",value:"0 0/1 * * * ?"},{name:"5m",value:"0 0/5 * * * ?"},{name:"1h",value:"0 0 0/1 * * ?"},{name:"3h",value:"0 0 0/3 * * ?"},{name:"6h",value:"0 0 0/6 * * ?"},{name:"12h",value:"0 0 0/12 * * ?"},{name:"1d",value:"0 0 0 * * ?"}],a.interpreterSettings=[],a.interpreterBindings=[],a.isNoteDirty=null,a.saveTimer=null;var l=!1;a.noteRevisions=[],a.$on("setConnectedStatus",function(a,b){l&&b&&m(),l=!0}),a.getCronOptionNameFromValue=function(b){if(!b)return"";for(var c in a.cronOption)if(a.cronOption[c].value===b)return a.cronOption[c].name;return b};var m=function(){g.getNotebook(c.noteId),g.listRevisionHistory(c.noteId);var d=b.current;d&&setTimeout(function(){var b=d.params,c=angular.element("#"+b.paragraph+"_container");if(c.length>0){var e=c.offset().top-103;angular.element("html, body").scrollTo({top:e,left:0})}a.$on("setNoteMenu",function(a,b){m()})},1e3)};m(),a.focusParagraphOnClick=function(b){if(a.note)for(var c=0;c<a.note.paragraphs.length;c++){var d=a.note.paragraphs[c].id;if(jQuery.contains(angular.element("#"+d+"_container")[0],b.target)){a.$broadcast("focusParagraph",d,0,!0);break}}},document.addEventListener("click",a.focusParagraphOnClick),a.keyboardShortcut=function(b){a.viewOnly||a.$broadcast("keyEvent",b)},document.addEventListener("keydown",a.keyboardShortcut),a.removeNote=function(a){BootstrapDialog.confirm({closable:!0,title:"",message:"Do you want to delete this notebook?",callback:function(b){b&&(g.deleteNotebook(a),d.path("/"))}})},a.exportNotebook=function(){var b=JSON.stringify(a.note);j.saveAs(b,a.note.name,"json")},a.cloneNote=function(a){BootstrapDialog.confirm({closable:!0,title:"",message:"Do you want to clone this notebook?",callback:function(b){b&&(g.cloneNotebook(a),d.path("/"))}})},a.checkpointNotebook=function(a){BootstrapDialog.confirm({closable:!0,title:"",message:"Commit notebook to current repository?",callback:function(b){b&&g.checkpointNotebook(c.noteId,a)}}),document.getElementById("note.checkpoint.message").value=""},a.$on("listRevisionHistory",function(b,c){a.noteRevisions=c.revisionList}),a.$on("noteRevision",function(a,b){}),a.runNote=function(){BootstrapDialog.confirm({closable:!0,title:"",message:"Run all paragraphs?",callback:function(b){b&&_.forEach(a.note.paragraphs,function(a,b){angular.element("#"+a.id+"_paragraphColumn_main").scope().runParagraph(a.text)})}})},a.saveNote=function(){a.note&&a.note.paragraphs&&(_.forEach(a.note.paragraphs,function(a,b){angular.element("#"+a.id+"_paragraphColumn_main").scope().saveParagraph()}),a.isNoteDirty=null)},a.clearAllParagraphOutput=function(){BootstrapDialog.confirm({closable:!0,title:"",message:"Do you want to clear all output?",callback:function(b){b&&_.forEach(a.note.paragraphs,function(a,b){angular.element("#"+a.id+"_paragraphColumn_main").scope().clearParagraphOutput()})}})},a.toggleAllEditor=function(){a.editorToggled?a.$broadcast("openEditor"):a.$broadcast("closeEditor"),a.editorToggled=!a.editorToggled},a.showAllEditor=function(){a.$broadcast("openEditor")},a.hideAllEditor=function(){a.$broadcast("closeEditor")},a.toggleAllTable=function(){a.tableToggled?a.$broadcast("openTable"):a.$broadcast("closeTable"),a.tableToggled=!a.tableToggled},a.showAllTable=function(){a.$broadcast("openTable")},a.hideAllTable=function(){a.$broadcast("closeTable")},a.isNoteRunning=function(){var b=!1;if(!a.note)return!1;for(var c=0;c<a.note.paragraphs.length;c++)if("PENDING"===a.note.paragraphs[c].status||"RUNNING"===a.note.paragraphs[c].status){b=!0;break}return b},a.killSaveTimer=function(){a.saveTimer&&(i.cancel(a.saveTimer),a.saveTimer=null)},a.startSaveTimer=function(){a.killSaveTimer(),a.isNoteDirty=!0,a.saveTimer=i(function(){a.saveNote()},1e4)},angular.element(window).on("beforeunload",function(b){a.killSaveTimer(),a.saveNote()}),a.setLookAndFeel=function(b){a.note.config.looknfeel=b,a.setConfig()},a.setCronScheduler=function(b){a.note.config.cron=b,a.setConfig()},a.setCronExecutingUser=function(b){a.note.config.cronExecutingUser=b,a.setConfig()},a.setReleaseResource=function(b){a.note.config.releaseresource=b,a.setConfig()},a.setConfig=function(b){b&&(a.note.config=b),g.updateNotebook(a.note.id,a.note.name,a.note.config)},a.sendNewName=function(){a.note.name&&g.updateNotebook(a.note.id,a.note.name,a.note.config)};var n=function(){a.note.config.looknfeel?a.viewOnly="report"===a.note.config.looknfeel:a.note.config.looknfeel="default",a.note.paragraphs[0].focus=!0,e.$broadcast("setLookAndFeel",a.note.config.looknfeel)},o=function(a,b){var c={};c.id=b.id,c.name=b.name,c.config=b.config,c.info=b.info,c.paragraphs=[];for(var d=0;d<b.paragraphs.length;d++)if(b.paragraphs[d].id===a){c.paragraphs[0]=b.paragraphs[d],c.paragraphs[0].config||(c.paragraphs[0].config={}),c.paragraphs[0].config.editorHide=!0,c.paragraphs[0].config.tableHide=!1;break}return c},p=function(b){b.name!==a.note.name&&(a.note.name=b.name),a.note.config=b.config,a.note.info=b.info;for(var c,d,e=b.paragraphs.map(function(a){return a.id}),f=a.note.paragraphs.map(function(a){return a.id}),g=e.length,h=f.length,i=0;i<a.note.paragraphs.length;i++){var j=a.note.paragraphs[i].id;if(angular.element("#"+j+"_paragraphColumn_main").scope().paragraphFocused){d=j;break}}if(g>h)for(var k in e){if(f[k]!==e[k]){a.note.paragraphs.splice(k,0,b.paragraphs[k]),c=b.paragraphs[k].id;break}a.$broadcast("updateParagraph",{note:a.note,paragraph:b.paragraphs[k]})}if(g===h)for(var l in e){var m=b.paragraphs[l];if(f[l]===e[l])a.$broadcast("updateParagraph",{note:a.note,paragraph:m});else{var n=f.indexOf(e[l]);a.note.paragraphs.splice(n,1),a.note.paragraphs.splice(l,0,m),f=a.note.paragraphs.map(function(a){return a.id})}d===e[l]&&(c=d)}if(g<h)for(var o in f)if(f[o]!==e[o]){a.note.paragraphs.splice(o,1);break}for(var p=0;p<a.note.paragraphs.length;p++)c===a.note.paragraphs[p].id&&(a.note.paragraphs[p].focus=!0)},q=function(){g.getInterpreterBindings(a.note.id)};a.$on("interpreterBindings",function(b,c){a.interpreterBindings=c.interpreterBindings,a.interpreterBindingsOrig=angular.copy(a.interpreterBindings);var d,e,f=!1;for(d in a.interpreterBindings)if(e=a.interpreterBindings[d],e.selected){f=!0;break}if(!f){var g={};for(d in a.interpreterBindings)e=a.interpreterBindings[d],g[e.name]||(e.selected=!0,g[e.name]=!0);a.showSetting=!0}}),a.interpreterSelectionListeners={accept:function(a,b){return!0},itemMoved:function(a){},orderChanged:function(a){}},a.openSetting=function(){a.showSetting=!0,q()},a.closeSetting=function(){s()?BootstrapDialog.confirm({closable:!0,title:"",message:"Interpreter setting changes will be discarded.",callback:function(b){b&&a.$apply(function(){a.showSetting=!1})}}):a.showSetting=!1},a.saveSetting=function(){var b=[];for(var c in a.interpreterBindings){var d=a.interpreterBindings[c];d.selected&&b.push(d.id)}g.saveInterpreterBindings(a.note.id,b),a.showSetting=!1},a.toggleSetting=function(){a.showSetting?a.closeSetting():(a.openSetting(),a.closePermissions())};var r=function(b){f.get(h.getRestApiBase()+"/notebook/"+a.note.id+"/permissions").success(function(c,d,e,f){a.permissions=c.body,a.permissionsOrig=angular.copy(a.permissions);var g={tokenSeparators:[","," "],ajax:{url:function(a){return!!a.term&&h.getRestApiBase()+"/security/userlist/"+a.term},delay:250,processResults:function(a,b){var c=[];if(0!==a.body.users.length){for(var d=[],e=0;e<a.body.users.length;e++)d.push({id:a.body.users[e],text:a.body.users[e]});c.push({text:"Users :",children:d})}if(0!==a.body.roles.length){for(var f=[],e=0;e<a.body.roles.length;e++)f.push({id:a.body.roles[e],text:a.body.roles[e]});c.push({text:"Roles :",children:f})}return{results:c,pagination:{more:!1}}},cache:!1},width:" ",tags:!0,minimumInputLength:3};angular.element("#selectOwners").select2(g),angular.element("#selectReaders").select2(g),angular.element("#selectWriters").select2(g),b&&b()}).error(function(a,b,c,d){})};a.openPermissions=function(){a.showPermissions=!0,r()},a.closePermissions=function(){t()?BootstrapDialog.confirm({closable:!0,title:"",message:"Changes will be discarded.",callback:function(b){b&&a.$apply(function(){a.showPermissions=!1})}}):a.showPermissions=!1},a.savePermissions=function(){k(),f.put(h.getRestApiBase()+"/notebook/"+a.note.id+"/permissions",a.permissions,{withCredentials:!0}).success(function(b,c,d,e){r(function(){BootstrapDialog.alert({closable:!0,title:"Permissions Saved Successfully!!!",message:"Owners : "+a.permissions.owners+"\n\nReaders : "+a.permissions.readers+"\n\nWriters  : "+a.permissions.writers}),a.showPermissions=!1})}).error(function(a,b,c,e){BootstrapDialog.show({closable:!1,closeByBackdrop:!1,closeByKeyboard:!1,title:"Insufficient privileges",message:a.message,buttons:[{label:"Login",action:function(a){a.close(),angular.element("#loginModal").modal({show:"true"})}},{label:"Cancel",action:function(a){a.close(),d.path("/")}}]})})},a.togglePermissions=function(){a.showPermissions?(a.closePermissions(),angular.element("#selectOwners").select2({}),angular.element("#selectReaders").select2({}),angular.element("#selectWriters").select2({})):(a.openPermissions(),a.closeSetting())};var s=function(){return!angular.equals(a.interpreterBindings,a.interpreterBindingsOrig)},t=function(){return!angular.equals(a.permissions,a.permissionsOrig)};angular.element(document).click(function(){angular.element(".ace_autocomplete").hide()}),a.$on("setConnectedStatus",function(a,b){l&&b&&m(),l=!0}),a.$on("moveParagraphUp",function(b,c){for(var d=-1,e=0;e<a.note.paragraphs.length;e++)if(a.note.paragraphs[e].id===c){d=e-1;break}if(!(d<0||d>=a.note.paragraphs.length)){var f=a.note.paragraphs[d].id;angular.element("#"+c+"_paragraphColumn_main").scope().saveParagraph(),angular.element("#"+f+"_paragraphColumn_main").scope().saveParagraph(),g.moveParagraph(c,d)}}),a.$on("moveParagraphDown",function(b,c){for(var d=-1,e=0;e<a.note.paragraphs.length;e++)if(a.note.paragraphs[e].id===c){d=e+1;break}if(!(d<0||d>=a.note.paragraphs.length)){var f=a.note.paragraphs[d].id;angular.element("#"+c+"_paragraphColumn_main").scope().saveParagraph(),angular.element("#"+f+"_paragraphColumn_main").scope().saveParagraph(),g.moveParagraph(c,d)}}),a.$on("moveFocusToPreviousParagraph",function(b,c){for(var d=!1,e=a.note.paragraphs.length-1;e>=0;e--){if(d!==!1){a.$broadcast("focusParagraph",a.note.paragraphs[e].id,-1);break}a.note.paragraphs[e].id!==c||(d=!0)}}),a.$on("moveFocusToNextParagraph",function(b,c){for(var d=!1,e=0;e<a.note.paragraphs.length;e++){if(d!==!1){a.$broadcast("focusParagraph",a.note.paragraphs[e].id,0);break}a.note.paragraphs[e].id!==c||(d=!0)}}),a.$on("insertParagraph",function(b,c,d){for(var e=-1,f=0;f<a.note.paragraphs.length;f++)if(a.note.paragraphs[f].id===c){e="above"===d?f:f+1;break}e<0||e>a.note.paragraphs.length||g.insertParagraph(e)}),a.$on("setNoteContent",function(b,f){void 0===f&&d.path("/"),a.paragraphUrl=c.paragraphId,a.asIframe=c.asIframe,a.paragraphUrl&&(f=o(a.paragraphUrl,f),e.$broadcast("setIframe",a.asIframe)),null===a.note?a.note=f:p(f),n(),q()}),a.$on("$destroy",function(){angular.element(window).off("beforeunload"),a.killSaveTimer(),a.saveNote(),document.removeEventListener("click",a.focusParagraphOnClick),document.removeEventListener("keydown",a.keyboardShortcut)})}]),angular.module("zeppelinWebApp").controller("JobmanagerCtrl",["$scope","websocketMsgSrv","$interval",function(a,b,c){a.filterValueToName=function(b){var c=_.findIndex(a.ACTIVE_INTERPRETERS,{value:b});return void 0!==a.ACTIVE_INTERPRETERS[c].name?a.ACTIVE_INTERPRETERS[c].name:"undefined"},a.init=function(){a.jobInfomations=[],a.JobInfomationsByFilter=a.jobInfomations,b.getNotebookJobsList(),a.$on("$destroy",function(){b.unsubscribeJobManager()})},a.$on("setNotebookJobs",function(b,c){a.lastJobServerUnixTime=c.lastResponseUnixTime,a.jobInfomations=c.jobs,a.jobInfomationsIndexs=a.jobInfomations?_.indexBy(a.jobInfomations,"notebookId"):{}}),a.$on("setUpdateNotebookJobs",function(b,c){var d=a.jobInfomations,e=a.jobInfomationsIndexs;a.lastJobServerUnixTime=c.lastResponseUnixTime;var f=c.jobs;f.map(function(a){if(void 0===e[a.notebookId]){var b=angular.copy(a);d.push(b),e[a.notebookId]=b}else{var c=e[a.notebookId];if(void 0!==a.isRemoved&&a.isRemoved===!0){var f=_.findIndex(e,a.notebookId);f>-1&&e.splice(f,1),f=_.findIndex(d,{notebookId:a.notebookId}),f&&d.splice(f,1)}else c.isRunningJob=a.isRunningJob,c.notebookName=a.notebookName,c.notebookType=a.notebookType,c.interpreter=a.interpreter,c.unixTimeLastRun=a.unixTimeLastRun,c.paragraphs=a.paragraphs}})})}]),angular.module("zeppelinWebApp").controller("JobCtrl",["$scope",function(a){a.init=function(b){a.progressValue=0},a.getProgress=function(){var b=_.pluck(a.notebookJob.paragraphs,"status"),c=_.countBy(b,function(a){return"FINISHED"===a||"RUNNING"===a?"matchCount":"none"}),d=b.length,e=c.matchCount,f=Math.ceil(e/d*100);return isNaN(f)?0:f}}]),angular.module("zeppelinWebApp").controller("InterpreterCtrl",["$scope","$http","baseUrlSrv","ngToast","$timeout","$route",function(a,b,c,d,e,f){var g=[];a.interpreterSettings=[],a.availableInterpreters={},a.showAddNewSetting=!1,a.showRepositoryInfo=!1,a._=_,a.openPermissions=function(){a.showInterpreterAuth=!0},a.closePermissions=function(){a.showInterpreterAuth=!1};var h=function(){var a={tags:!1,multiple:!0,tokenSeparators:[","," "],minimumInputLength:2,ajax:{url:function(a){return!!a.term&&c.getRestApiBase()+"/security/userlist/"+a.term},delay:250,processResults:function(a,b){var c=[];if(0!==a.body.users.length)for(var d=0;d<a.body.users.length;d++)c.push({id:a.body.users[d],text:a.body.users[d]});return{results:c,pagination:{more:!1}}},cache:!1}};return a};a.togglePermissions=function(b){angular.element("#"+b+"Users").select2(h()),a.showInterpreterAuth?a.closePermissions():a.openPermissions()},a.$on("ngRenderFinished",function(b,c){for(var d=0;d<a.interpreterSettings.length;d++)angular.element("#"+a.interpreterSettings[d].name+"Users").select2(h())});var i=function(){b.get(c.getRestApiBase()+"/interpreter/setting").success(function(b,c,d,e){a.interpreterSettings=b.body,j()}).error(function(a,b,c,e){401===b&&(d.danger({content:"You don't have permission on this page",verticalPosition:"bottom",timeout:"3000"}),setTimeout(function(){window.location.replace("/")},3e3))})},j=function(){for(var b=!1,c=0;c<a.interpreterSettings.length;c++)if("DOWNLOADING_DEPENDENCIES"===a.interpreterSettings[c].status){b=!0;break}b&&e(function(){"/interpreter"===f.current.$$route.originalPath&&i()},2e3)},k=function(){b.get(c.getRestApiBase()+"/interpreter").success(function(b,c,d,e){a.availableInterpreters=b.body}).error(function(a,b,c,d){})},l=function(a){angular.extend(a,{propertyValue:"",propertyKey:""})},m=function(a){angular.extend(a,{depArtifact:"",depExclude:""})},n=function(a){g.splice(a,1)};a.copyOriginInterpreterSettingProperties=function(b){var c=_.findIndex(a.interpreterSettings,{id:b});g[c]=angular.copy(a.interpreterSettings[c])},a.setSessionOption=function(b,c){var d;if(void 0===b)d=a.newInterpreterSetting.option;else{var e=_.findIndex(a.interpreterSettings,{id:b}),f=a.interpreterSettings[e];d=f.option}"isolated"===c?(d.perNoteSession=!1,d.perNoteProcess=!0):"scoped"===c?(d.perNoteSession=!0,d.perNoteProcess=!1):(d.perNoteSession=!1,d.perNoteProcess=!1)},a.getSessionOption=function(b){var c;if(void 0===b)c=a.newInterpreterSetting.option;else{var d=_.findIndex(a.interpreterSettings,{id:b}),e=a.interpreterSettings[d];c=e.option}return c.perNoteSession?"scoped":c.perNoteProcess?"isolated":"shared"},a.updateInterpreterSetting=function(e,g){var h=BootstrapDialog.confirm({closable:!1,closeByBackdrop:!1,closeByKeyboard:!1,title:"",message:"Do you want to update this interpreter and restart with new settings?",callback:function(i){if(i){var k=_.findIndex(a.interpreterSettings,{id:g}),l=a.interpreterSettings[k];(""!==l.propertyKey||l.propertyKey)&&a.addNewInterpreterProperty(g),(""!==l.depArtifact||l.depArtifact)&&a.addNewInterpreterDependency(g),l.option||(l.option={}),void 0===l.option.isExistingProcess&&(l.option.isExistingProcess=!1),void 0===l.option.setPermission&&(l.option.setPermission=!1),void 0===l.option.remote&&(l.option.remote=!0),l.option.users=angular.element("#"+l.name+"Users").val();var m={option:angular.copy(l.option),properties:angular.copy(l.properties),dependencies:angular.copy(l.dependencies)};return h.$modalFooter.find("button").addClass("disabled"),h.$modalFooter.find('button:contains("OK")').html('<i class="fa fa-circle-o-notch fa-spin"></i> Saving Setting'),b.put(c.getRestApiBase()+"/interpreter/setting/"+g,m).success(function(b,c,d,e){a.interpreterSettings[k]=b.body,n(k),h.close(),j(),f.reload()}).error(function(a,b,c,f){d.danger({content:a.message,verticalPosition:"bottom"}),e.$show(),h.close()}),!1}e.$show()}})},a.resetInterpreterSetting=function(b){var c=_.findIndex(a.interpreterSettings,{id:b});a.interpreterSettings[c]=angular.copy(g[c]),n(c)},a.removeInterpreterSetting=function(d){BootstrapDialog.confirm({closable:!0,title:"",message:"Do you want to delete this interpreter setting?",callback:function(e){e&&b.delete(c.getRestApiBase()+"/interpreter/setting/"+d).success(function(b,c,e,f){var g=_.findIndex(a.interpreterSettings,{id:d});a.interpreterSettings.splice(g,1)}).error(function(a,b,c,d){})}})},a.newInterpreterGroupChange=function(){for(var b=_.pluck(_.filter(a.availableInterpreters,{name:a.newInterpreterSetting.group}),"properties"),c={},d=0;d<b.length;d++){var e=b[d];for(var f in e)c[f]={value:e[f],description:e[f].description}}a.newInterpreterSetting.properties=c},a.restartInterpreterSetting=function(d){BootstrapDialog.confirm({closable:!0,title:"",message:"Do you want to restart this interpreter?",callback:function(e){e&&b.put(c.getRestApiBase()+"/interpreter/setting/restart/"+d).success(function(b,c,e,f){var g=_.findIndex(a.interpreterSettings,{id:d});a.interpreterSettings[g]=b.body}).error(function(a,b,c,d){})}})},a.addNewInterpreterSetting=function(){if(!a.newInterpreterSetting.name||!a.newInterpreterSetting.name.trim()||!a.newInterpreterSetting.group)return void BootstrapDialog.alert({closable:!0,title:"Add interpreter",message:"Please fill in interpreter name and choose a group"});if(a.newInterpreterSetting.name.indexOf(".")>=0)return void BootstrapDialog.alert({closable:!0,title:"Add interpreter",message:"'.' is invalid for interpreter name"});if(_.findIndex(a.interpreterSettings,{name:a.newInterpreterSetting.name})>=0)return void BootstrapDialog.alert({closable:!0,title:"Add interpreter",message:"Name "+a.newInterpreterSetting.name+" already exists"});var e=a.newInterpreterSetting;(""!==e.propertyKey||e.propertyKey)&&a.addNewInterpreterProperty(),(""!==e.depArtifact||e.depArtifact)&&a.addNewInterpreterDependency(),void 0===e.option.setPermission&&(e.option.setPermission=!1),e.option.users=angular.element("#newInterpreterUsers").val();var f=angular.copy(a.newInterpreterSetting),g={};for(var h in e.properties)g[h]=e.properties[h].value;f.properties=g,b.post(c.getRestApiBase()+"/interpreter/setting",f).success(function(b,c,d,e){a.resetNewInterpreterSetting(),i(),a.showAddNewSetting=!1,j()}).error(function(a,b,c,e){d.danger({content:a.message,verticalPosition:"bottom"})})},a.cancelInterpreterSetting=function(){a.showAddNewSetting=!1,a.resetNewInterpreterSetting()},a.resetNewInterpreterSetting=function(){a.newInterpreterSetting={name:void 0,group:void 0,properties:{},dependencies:[],option:{remote:!0,isExistingProcess:!1,setPermission:!1,perNoteSession:!1,perNoteProcess:!1}},l(a.newInterpreterSetting)},a.removeInterpreterProperty=function(b,c){if(void 0===c)delete a.newInterpreterSetting.properties[b];else{var d=_.findIndex(a.interpreterSettings,{id:c});delete a.interpreterSettings[d].properties[b]}},a.removeInterpreterDependency=function(b,c){if(void 0===c)a.newInterpreterSetting.dependencies=_.reject(a.newInterpreterSetting.dependencies,function(a){return a.groupArtifactVersion===b});else{var d=_.findIndex(a.interpreterSettings,{id:c});a.interpreterSettings[d].dependencies=_.reject(a.interpreterSettings[d].dependencies,function(a){return a.groupArtifactVersion===b})}},a.addNewInterpreterProperty=function(b){if(void 0===b){if(!a.newInterpreterSetting.propertyKey||""===a.newInterpreterSetting.propertyKey)return;a.newInterpreterSetting.properties[a.newInterpreterSetting.propertyKey]={value:a.newInterpreterSetting.propertyValue},l(a.newInterpreterSetting)}else{var c=_.findIndex(a.interpreterSettings,{id:b}),d=a.interpreterSettings[c];if(!d.propertyKey||""===d.propertyKey)return;d.properties[d.propertyKey]=d.propertyValue,l(d)}},a.addNewInterpreterDependency=function(b){if(void 0===b){if(!a.newInterpreterSetting.depArtifact||""===a.newInterpreterSetting.depArtifact)return;var c=a.newInterpreterSetting;for(var d in c.dependencies)c.dependencies[d].groupArtifactVersion===c.depArtifact&&(c.dependencies[d]={groupArtifactVersion:c.depArtifact,exclusions:c.depExclude},c.dependencies.splice(d,1));c.dependencies.push({groupArtifactVersion:c.depArtifact,exclusions:""===c.depExclude?[]:c.depExclude}),m(c)}else{var e=_.findIndex(a.interpreterSettings,{id:b}),f=a.interpreterSettings[e];if(!f.depArtifact||""===f.depArtifact)return;for(var g in f.dependencies)f.dependencies[g].groupArtifactVersion===f.depArtifact&&(f.dependencies[g]={groupArtifactVersion:f.depArtifact,exclusions:f.depExclude},f.dependencies.splice(g,1));f.dependencies.push({groupArtifactVersion:f.depArtifact,exclusions:""===f.depExclude?[]:f.depExclude}),m(f)}},a.resetNewRepositorySetting=function(){a.newRepoSetting={id:"",url:"",snapshot:!1,username:"",password:""}};var o=function(){b.get(c.getRestApiBase()+"/interpreter/repository").success(function(b,c,d,e){a.repositories=b.body}).error(function(a,b,c,d){})};a.addNewRepository=function(){var d=angular.copy(a.newRepoSetting);b.post(c.getRestApiBase()+"/interpreter/repository",d).success(function(b,c,d,e){o(),a.resetNewRepositorySetting(),angular.element("#repoModal").modal("hide")}).error(function(a,b,c,d){})},a.removeRepository=function(d){BootstrapDialog.confirm({closable:!0,title:"",message:"Do you want to delete this repository?",callback:function(e){e&&b.delete(c.getRestApiBase()+"/interpreter/repository/"+d).success(function(b,c,e,f){var g=_.findIndex(a.repositories,{id:d});a.repositories.splice(g,1)}).error(function(a,b,c,d){})}})},a.isDefaultRepository=function(a){return"central"===a||"local"===a},a.showErrorMessage=function(a){BootstrapDialog.show({title:"Error downloading dependencies",message:a.errorReason})};var p=function(){a.resetNewInterpreterSetting(),a.resetNewRepositorySetting(),i(),k(),o()};p()}]),angular.module("zeppelinWebApp").filter("sortByKey",function(){return function(a){var b=a?Object.keys(a):[];return b.sort()}}),angular.module("zeppelinWebApp").controller("CredentialCtrl",["$scope","$rootScope","$http","baseUrlSrv","ngToast",function(a,b,c,d,e){a._=_,a.credentialInfo=[],a.showAddNewCredentialInfo=!1;var f=function(){c.get(d.getRestApiBase()+"/credential").success(function(b,c,d,e){a.credentialInfo=_.map(b.body.userCredentials,function(a,b){return{entity:b,password:a.password,username:a.username}})}).error(function(a,b,c,d){401===b&&(e.danger({content:"You don't have permission on this page",verticalPosition:"bottom",timeout:"3000"}),setTimeout(function(){window.location.replace("/")},3e3))})};a.addNewCredentialInfo=function(){if(a.entity&&_.isEmpty(a.entity.trim())&&a.username&&_.isEmpty(a.username.trim()))return void e.danger({content:"Username \\ Entity can not be empty.",verticalPosition:"bottom",timeout:"3000"});var b={entity:a.entity,username:a.username,password:a.password};c.put(d.getRestApiBase()+"/credential",b).success(function(c,d,f,h){e.success({content:"Successfully saved credentials.",verticalPosition:"bottom",timeout:"3000"}),a.credentialInfo.push(b),g(),a.showAddNewCredentialInfo=!1}).error(function(a,b,c,d){e.danger({content:"Error saving credentials",verticalPosition:"bottom",timeout:"3000"})})},a.cancelCredentialInfo=function(){a.showAddNewCredentialInfo=!1,g()};var g=function(){a.entity="",a.username="",a.password=""};a.copyOriginCredentialsInfo=function(){e.info({content:"Since entity is a unique key, you can edit only username & password",verticalPosition:"bottom",timeout:"3000"})},a.updateCredentialInfo=function(b,f,g){var h={entity:g,username:f.username,password:f.password};return c.put(d.getRestApiBase()+"/credential/",h).success(function(b,c,d,e){var f=_.findIndex(a.credentialInfo,{entity:g});return a.credentialInfo[f]=h,!0}).error(function(a,c,d,f){e.danger({content:"We couldn't save the credential",verticalPosition:"bottom",timeout:"3000"}),b.$show()}),!1},a.removeCredentialInfo=function(b){BootstrapDialog.confirm({closable:!1,closeByBackdrop:!1,closeByKeyboard:!1,title:"",message:"Do you want to delete this credential information?",callback:function(e){e&&c.delete(d.getRestApiBase()+"/credential/"+b).success(function(c,d,e,f){var g=_.findIndex(a.credentialInfo,{entity:b});a.credentialInfo.splice(g,1)}).error(function(a,b,c,d){})}})};var h=function(){f()};h()}]),angular.module("zeppelinWebApp").controller("ConfigurationCtrl",["$scope","$rootScope","$http","baseUrlSrv","ngToast",function(a,b,c,d,e){a.configrations=[],a._=_;var f=function(){c.get(d.getRestApiBase()+"/configurations/all").success(function(b,c,d,e){a.configurations=b.body}).error(function(a,b,c,d){401===b&&(e.danger({content:"You don't have permission on this page",verticalPosition:"bottom",timeout:"3000"}),setTimeout(function(){window.location.replace("/")},3e3))})},g=function(){f()};g()}]),angular.module("zeppelinWebApp").controller("ParagraphCtrl",["$scope","$rootScope","$route","$window","$routeParams","$location","$timeout","$compile","$http","$q","websocketMsgSrv","baseUrlSrv","ngToast","saveAsService","esriLoader",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p="_Z_ANGULAR_FUNC_";a.parentNote=null,a.paragraph=null,a.originalText="",a.editor=null,a.magic=null;var q=b.$new(!0,b);a.compiledScope=q,q.z={runParagraph:function(b){if(b){var c=a.parentNote.paragraphs.filter(function(a){return a.id===b});if(1===c.length){var d=c[0];k.runParagraph(d.id,d.title,d.text,d.config,d.settings.params)}else m.danger({content:"Cannot find a paragraph with id '"+b+"'",verticalPosition:"top",dismissOnTimeout:!1})}else m.danger({content:"Please provide a 'paragraphId' when calling z.runParagraph(paragraphId)",verticalPosition:"top",dismissOnTimeout:!1})},angularBind:function(a,b,c){c?k.clientBindAngularObject(e.noteId,a,b,c):m.danger({content:"Please provide a 'paragraphId' when calling z.angularBind(varName, value, 'PUT_HERE_PARAGRAPH_ID')",verticalPosition:"top",dismissOnTimeout:!1})},angularUnbind:function(a,b){b?k.clientUnbindAngularObject(e.noteId,a,b):m.danger({content:"Please provide a 'paragraphId' when calling z.angularUnbind(varName, 'PUT_HERE_PARAGRAPH_ID')",verticalPosition:"top",dismissOnTimeout:!1})}};var r={};a.init=function(b,c){a.paragraph=b,a.parentNote=c,a.originalText=angular.copy(b.text),a.chart={},a.baseMapOption=["Streets","Satellite","Hybrid","Topo","Gray","Oceans","Terrain"],a.colWidthOption=[1,2,3,4,5,6,7,8,9,10,11,12],a.paragraphFocused=!1,b.focus&&(a.paragraphFocused=!0),a.paragraph.config||(a.paragraph.config={}),s(),"TABLE"===a.getResultType()?(a.loadTableData(a.paragraph.result),a.setGraphMode(a.getGraphMode(),!1,!1)):"HTML"===a.getResultType()?a.renderHtml():"ANGULAR"===a.getResultType()?a.renderAngular():"TEXT"===a.getResultType()&&a.renderText(),O(),P();var d=_.get(a.paragraph.config,"helium.activeApp");if(d){var e=_.find(a.apps,{id:d});S(e)}},a.renderHtml=function(){var b=function(){if(angular.element("#p"+a.paragraph.id+"_html").length)try{angular.element("#p"+a.paragraph.id+"_html").html(a.paragraph.result.msg),angular.element("#p"+a.paragraph.id+"_html").find("pre code").each(function(a,b){
hljs.highlightBlock(b)})}catch(a){}else g(b,10)};g(b)},a.renderAngular=function(){var b=function(){if(angular.element("#p"+a.paragraph.id+"_angular").length)try{angular.element("#p"+a.paragraph.id+"_angular").html(a.paragraph.result.msg),h(angular.element("#p"+a.paragraph.id+"_angular").contents())(q)}catch(a){}else g(b,10)};g(b)},a.renderText=function(){var b=function(){var c=angular.element("#p"+a.paragraph.id+"_text");c.length?(a.clearTextOutput(),a.paragraph.result&&a.paragraph.result.msg&&a.appendTextOutput(a.paragraph.result.msg),angular.element("#p"+a.paragraph.id+"_text").bind("mousewheel",function(b){a.keepScrollDown=!1}),a.flushStreamingOutput=!0):g(b,10)};g(b)},a.clearTextOutput=function(){var b=angular.element("#p"+a.paragraph.id+"_text");b.length&&b.children().remove()},a.appendTextOutput=function(b){var c=angular.element("#p"+a.paragraph.id+"_text");if(c.length)for(var d=b.split("\n"),e=0;e<d.length;e++)c.append(angular.element("<div></div>").text(d[e]));if(a.keepScrollDown){var f=angular.element("#p"+a.paragraph.id+"_text");f[0].scrollTop=f[0].scrollHeight}};var s=function(){var b=a.paragraph.config;b.colWidth||(b.colWidth=12),b.graph||(b.graph={}),b.graph.mode||(b.graph.mode="table"),b.graph.height||(b.graph.height=300),b.graph.optionOpen||(b.graph.optionOpen=!1),b.graph.keys||(b.graph.keys=[]),b.graph.values||(b.graph.values=[]),b.graph.groups||(b.graph.groups=[]),b.graph.scatter||(b.graph.scatter={}),b.graph.map||(b.graph.map={}),b.graph.map.baseMapType||(b.graph.map.baseMapType=a.baseMapOption[0]),b.graph.map.isOnline||(b.graph.map.isOnline=!0),b.graph.map.pinCols||(b.graph.map.pinCols=[]),void 0===b.enabled&&(b.enabled=!0)};a.getIframeDimensions=function(){if(a.asIframe){var b="#"+e.paragraphId+"_container",c=angular.element(b).height();return c}return 0},a.$watch(a.getIframeDimensions,function(b,c){if(a.asIframe&&b){var e={};e.height=b,e.url=f.$$absUrl,d.parent.postMessage(angular.toJson(e),"*")}});var t=function(a){return!a};a.isRunning=function(){return"RUNNING"===a.paragraph.status||"PENDING"===a.paragraph.status},a.cancelParagraph=function(){k.cancelParagraphRun(a.paragraph.id)},a.runParagraph=function(b){k.runParagraph(a.paragraph.id,a.paragraph.title,b,a.paragraph.config,a.paragraph.settings.params),a.originalText=angular.copy(b),a.dirtyText=void 0},a.saveParagraph=function(){void 0!==a.dirtyText&&a.dirtyText!==a.originalText&&(y(a.paragraph.title,a.dirtyText,a.paragraph.config,a.paragraph.settings.params),a.originalText=angular.copy(a.dirtyText),a.dirtyText=void 0)},a.toggleEnableDisable=function(){a.paragraph.config.enabled=!a.paragraph.config.enabled;var b=angular.copy(a.paragraph.settings.params),c=angular.copy(a.paragraph.config);y(a.paragraph.title,a.paragraph.text,c,b)},a.run=function(){var b=a.editor.getValue();b&&"RUNNING"!==a.paragraph.status&&"PENDING"!==a.paragraph.status&&a.runParagraph(b)},a.moveUp=function(){a.$emit("moveParagraphUp",a.paragraph.id)},a.moveDown=function(){a.$emit("moveParagraphDown",a.paragraph.id)},a.insertNew=function(b){a.$emit("insertParagraph",a.paragraph.id,b||"below")},a.removeParagraph=function(){var b=angular.element('div[id$="_paragraphColumn_main"]');b[b.length-1].id.startsWith(a.paragraph.id)?BootstrapDialog.alert({closable:!0,message:"The last paragraph can't be deleted."}):BootstrapDialog.confirm({closable:!0,title:"",message:"Do you want to delete this paragraph?",callback:function(b){b&&k.removeParagraph(a.paragraph.id)}})},a.clearParagraphOutput=function(){k.clearParagraphOutput(a.paragraph.id)},a.toggleEditor=function(){a.paragraph.config.editorHide?a.openEditor():a.closeEditor()},a.closeEditor=function(){var b=angular.copy(a.paragraph.settings.params),c=angular.copy(a.paragraph.config);c.editorHide=!0,y(a.paragraph.title,a.paragraph.text,c,b)},a.openEditor=function(){var b=angular.copy(a.paragraph.settings.params),c=angular.copy(a.paragraph.config);c.editorHide=!1,y(a.paragraph.title,a.paragraph.text,c,b)},a.closeTable=function(){var b=angular.copy(a.paragraph.settings.params),c=angular.copy(a.paragraph.config);c.tableHide=!0,y(a.paragraph.title,a.paragraph.text,c,b)},a.openTable=function(){var b=angular.copy(a.paragraph.settings.params),c=angular.copy(a.paragraph.config);c.tableHide=!1,y(a.paragraph.title,a.paragraph.text,c,b)},a.showTitle=function(){var b=angular.copy(a.paragraph.settings.params),c=angular.copy(a.paragraph.config);c.title=!0,y(a.paragraph.title,a.paragraph.text,c,b)},a.hideTitle=function(){var b=angular.copy(a.paragraph.settings.params),c=angular.copy(a.paragraph.config);c.title=!1,y(a.paragraph.title,a.paragraph.text,c,b)},a.setTitle=function(){var b=angular.copy(a.paragraph.settings.params),c=angular.copy(a.paragraph.config);y(a.paragraph.title,a.paragraph.text,c,b)},a.showLineNumbers=function(){var b=angular.copy(a.paragraph.settings.params),c=angular.copy(a.paragraph.config);c.lineNumbers=!0,a.editor.renderer.setShowGutter(!0),y(a.paragraph.title,a.paragraph.text,c,b)},a.hideLineNumbers=function(){var b=angular.copy(a.paragraph.settings.params),c=angular.copy(a.paragraph.config);c.lineNumbers=!1,a.editor.renderer.setShowGutter(!1),y(a.paragraph.title,a.paragraph.text,c,b)},a.columnWidthClass=function(b){return a.asIframe?"col-md-12":"col-md-"+b},a.changeColWidth=function(b){if(angular.element(".navbar-right.open").removeClass("open"),!b||b!==a.paragraph.config.colWidth){b&&(a.paragraph.config.colWidth=b);var c=angular.copy(a.paragraph.settings.params),d=angular.copy(a.paragraph.config);y(a.paragraph.title,a.paragraph.text,d,c)}},a.toggleGraphOption=function(){var b=angular.copy(a.paragraph.config);b.graph.optionOpen?b.graph.optionOpen=!1:b.graph.optionOpen=!0;var c=angular.copy(a.paragraph.settings.params);y(a.paragraph.title,a.paragraph.text,b,c)},a.toggleOutput=function(){var b=angular.copy(a.paragraph.config);b.tableHide=!b.tableHide;var c=angular.copy(a.paragraph.settings.params);y(a.paragraph.title,a.paragraph.text,b,c)},a.toggleLineWithFocus=function(){var b=a.getGraphMode();return"lineWithFocusChart"===b?(a.setGraphMode("lineChart",!0),!0):"lineChart"===b&&(a.setGraphMode("lineWithFocusChart",!0),!0)},a.loadForm=function(b,c){var d=b.defaultValue;c[b.name]&&(d=c[b.name]),a.paragraph.settings.params[b.name]=d},a.toggleCheckbox=function(b,c){var d=a.paragraph.settings.params[b.name].indexOf(c.value);d>-1?a.paragraph.settings.params[b.name].splice(d,1):a.paragraph.settings.params[b.name].push(c.value)},a.aceChanged=function(){a.dirtyText=a.editor.getSession().getValue(),a.startSaveTimer(),v(a.editor.getSession(),a.dirtyText,a.editor.getCursorPosition())},a.aceLoaded=function(c){var d=ace.require("ace/ext/language_tools"),e=ace.require("ace/range").Range;if(c.$blockScrolling=1/0,a.editor=c,a.editor.on("input",a.aceChanged),"{{paragraph.id}}_editor"!==c.container.id){a.editor.renderer.setShowGutter(a.paragraph.config.lineNumbers),a.editor.setShowFoldWidgets(!1),a.editor.setHighlightActiveLine(!1),a.editor.setHighlightGutterLine(!1),a.editor.getSession().setUseWrapMode(!0),a.editor.setTheme("ace/theme/chrome"),a.editor.setReadOnly(a.isRunning()),a.paragraphFocused&&(a.editor.focus(),a.goToEnd()),w(c.container.id),angular.element(window).resize(function(){w(c.container.id)}),navigator.appVersion.indexOf("Mac")!==-1?(a.editor.setKeyboardHandler("ace/keyboard/emacs"),b.isMac=!0):navigator.appVersion.indexOf("Win")===-1&&navigator.appVersion.indexOf("X11")===-1&&navigator.appVersion.indexOf("Linux")===-1||(b.isMac=!1);var f={getCompletions:function(b,c,d,f,g){if(a.editor.isFocused()){d=c.getTextRange(new e(0,0,d.row,d.column)).length;var h=c.getValue();k.completion(a.paragraph.id,h,d),a.$on("completionList",function(a,b){if(b.completions){var c=[];for(var d in b.completions){var e=b.completions[d];c.push({name:e.name,value:e.value,score:300})}g(null,c)}})}}};d.setCompleters([f,d.keyWordCompleter,d.snippetCompleter,d.textCompleter]),a.editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!1,enableLiveAutocompletion:!1}),a.handleFocus=function(b,c){a.paragraphFocused=b,c!==!1&&void 0!==c||g(function(){a.$digest()})},a.editor.on("focus",function(){a.handleFocus(!0)}),a.editor.on("blur",function(){a.handleFocus(!1)}),a.editor.getSession().on("change",function(a,b){w(c.container.id)}),v(a.editor.getSession(),a.editor.getSession().getValue()),a.editor.commands.bindKey("ctrl-alt-n.",null),a.editor.commands.removeCommand("showSettingsMenu"),a.editor.commands.bindKey("ctrl-.","startAutocomplete"),a.editor.commands.bindKey("ctrl-space",null);var h=function(b){var c=a.editor.getSession().getLength(),d=a.editor.getCursorPosition().row;0===d&&b<=0?a.$emit("moveFocusToPreviousParagraph",a.paragraph.id):d===c-1&&b>=0?a.$emit("moveFocusToNextParagraph",a.paragraph.id):a.scrollToCursor(a.paragraph.id,b)};a.editor.keyBinding.origOnCommandKey=a.editor.keyBinding.onCommandKey,a.editor.keyBinding.onCommandKey=function(b,c,d){if(a.editor.completer&&a.editor.completer.activated);else{if(parseInt(angular.element("#"+a.paragraph.id+"_editor > textarea").css("top").replace("px",""))<0){var e=a.editor.getCursorPosition(),f=a.editor.renderer.$cursorLayer.getPixelPosition(e,!0);angular.element("#"+a.paragraph.id+"_editor > textarea").css("top",f.top)}var g=-1,i=1;switch(d){case 38:h(g);break;case 80:b.ctrlKey&&!b.altKey&&h(g);break;case 40:h(i);break;case 78:b.ctrlKey&&!b.altKey&&h(i)}}this.origOnCommandKey(b,c,d)}}};var u=function(b,c){var d=j.defer();k.getEditorSetting(c),g(a.$on("editorSetting",function(a,b){d.resolve(b)}),1e3),d.promise.then(function(c){if(!_.isEmpty(c.editor)){var d="ace/mode/"+c.editor.language;a.paragraph.config.editorMode=d,b.setMode(d)}})},v=function(b,c,d){if("undefined"==typeof d||0===d.row&&d.column<30||1===d.row&&0===d.column)if("undefined"==typeof d&&a.paragraph.config.editorMode)b.setMode(a.paragraph.config.editorMode);else{var e;if(!c.startsWith("%")&&"undefined"!=typeof d&&0===d.row&&1===d.column||"undefined"==typeof d&&0!==a.$parent.interpreterBindings.length)e=a.$parent.interpreterBindings[0].name,u(b,e);else{var f=/%(.+?)\s/g,g=f.exec(c);g&&a.magic!==g[1]&&(e=g[1].trim(),a.magic=e,u(b,e))}}},w=function(b){var c=a.editor,d=c.getSession().getScreenLength()*c.renderer.lineHeight+c.renderer.scrollBar.getWidth();angular.element("#"+b).height(d.toString()+"px"),c.resize()};b.$on("scrollToCursor",function(b){var c=angular.element('div[id$="_paragraphColumn_main"]');c[c.length-1].id.startsWith(a.paragraph.id)&&a.scrollToCursor(a.paragraph.id,0)}),a.scrollToCursor=function(b,c){if(a.editor.isFocused()){var d,e=a.editor.renderer.lineHeight,f=103,g=50,h=angular.element(document).height(),i=angular.element(window).height(),j=angular.element(document).scrollTop(),k=angular.element("#"+b+"_editor").offset(),l=a.editor.getCursorPosition(),m=a.editor.renderer.$cursorLayer.getPixelPosition(l,!0),n=k.top+m.top+e*c;n<j+f+g?(d=n-f-(i-f)/3,d<0&&(d=0)):n>j+g+i-f&&(d=n-f-2*(i-f)/3,d>h&&(d=h));var o=angular.element("body");o.stop(),o.finish(),o.scrollTo(d,{axis:"y",interrupt:!0,duration:100})}},a.getEditorValue=function(){return a.editor.getValue()},a.getProgress=function(){return a.currentProgress?a.currentProgress:0},a.getExecutionTime=function(){var b=a.paragraph,c=Date.parse(b.dateFinished)-Date.parse(b.dateStarted);if(isNaN(c)||c<0)return a.isResultOutdated()?"outdated":"";var d=void 0===b.user||null===b.user?"anonymous":b.user,e="Took "+moment.duration(c/1e3,"seconds").format("h [hrs] m [min] s [sec]")+". Last updated by "+d+" at "+moment(b.dateFinished).format("MMMM DD YYYY, h:mm:ss A")+".";return a.isResultOutdated()&&(e+=" (outdated)"),e},a.getElapsedTime=function(){return"Started "+moment(a.paragraph.dateStarted).fromNow()+"."},a.isResultOutdated=function(){var b=a.paragraph;return void 0!==b.dateUpdated&&Date.parse(b.dateUpdated)>Date.parse(b.dateStarted)},a.goToEnd=function(){a.editor.navigateFileEnd()},a.getResultType=function(b){var c=b?b:a.paragraph;return c.result&&c.result.type?c.result.type:"TEXT"},a.getBase64ImageSrc=function(a){return"data:image/png;base64,"+a},a.getGraphMode=function(b){var c=b?b:a.paragraph;return c.config.graph&&c.config.graph.mode?c.config.graph.mode:"table"},a.parseTableCell=function(a){if(!isNaN(a))return 0===a.length||Number(a)>Number.MAX_SAFE_INTEGER||Number(a)<Number.MIN_SAFE_INTEGER?a:Number(a);var b=moment(a);return b.isValid()?b:a},a.loadTableData=function(b){if(b&&"TABLE"===b.type){var c=[],d=[],e=[],f=b.msg.split("\n");b.comment="";for(var g=!1,h=0;h<f.length;h++){var i=f[h];if(g)b.comment+=i;else if(""!==i){for(var j=i.split("\t"),k=[],l=[],m=0;m<j.length;m++){var n=j[m];if(0===h)c.push({name:n,index:m,aggr:"sum"});else{var o=a.parseTableCell(n);k.push(o),l.push({key:c[h]?c[h].name:void 0,value:o})}}0!==h&&(d.push(k),e.push(l))}else d.length>0&&(g=!0)}b.msgTable=e,b.columnNames=c,b.rows=d}},a.setGraphMode=function(b,c,d){if(c)x(b);else{G();var e=a.paragraph.config.graph.height;angular.element("#p"+a.paragraph.id+"_graph").height(e),b&&"table"!==b?"map"===b?F(a.paragraph.result,d):E(b,a.paragraph.result,d):z(a.paragraph.result,d)}};var x=function(b){var c=angular.copy(a.paragraph.config),d=angular.copy(a.paragraph.settings.params);c.graph.mode=b,_.set(c,"helium.activeApp",void 0),y(a.paragraph.title,a.paragraph.text,c,d)},y=function(b,c,d,e){k.commitParagraph(a.paragraph.id,b,c,d,e)},z=function(b,c){var d=function(){var c=a.paragraph.config.graph.height,d=angular.element("#p"+a.paragraph.id+"_table").css("height",c).get(0),e=b.rows,f=_.pluck(b.columnNames,"name");a.hot&&a.hot.destroy(),a.hot=new Handsontable(d,{colHeaders:f,data:e,rowHeaders:!1,stretchH:"all",sortIndicator:!0,columnSorting:!0,contextMenu:!1,manualColumnResize:!0,manualRowResize:!0,readOnly:!0,readOnlyCellClassName:"",fillHandle:!1,fragmentSelection:!0,disableVisualSelection:!0,cells:function(a,b,c){var d={};return d.renderer=function(a,b,c,d,e,f,g){f instanceof moment?b.innerHTML=f._i:isNaN(f)?f.length>"%html".length&&"%html "===f.substring(0,"%html ".length)?b.innerHTML=f.substring("%html".length):Handsontable.renderers.TextRenderer.apply(this,arguments):(g.format="0,0.[00000]",b.style.textAlign="left",Handsontable.renderers.NumericRenderer.apply(this,arguments))},d}})},e=function(){if(angular.element("#p"+a.paragraph.id+"_table").length)try{d()}catch(a){}else g(e,10)};g(e)},A=function(a){return d3.format(",")(d3.round(a,3))},B=function(a){var b=d3.format(".3s")(a);switch(b[b.length-1]){case"G":return b.slice(0,-1)+"B"}return b},C=function(a,b){return!b[a]||!isNaN(parseFloat(b[a]))&&isFinite(b[a])?a:b[a]},D=function(a){return Math.abs(a)>=Math.pow(10,6)?B(a):A(a)},E=function(b,c,d){if(!a.chart[b]){var e=nv.models[b]();a.chart[b]=e}var f,h,i=[];if("scatterChart"===b){var j=L(c,d);f=j.xLabels,h=j.yLabels,i=j.d3g,a.chart[b].xAxis.tickFormat(function(a){return C(a,f)}),a.chart[b].yAxis.tickFormat(function(a){return D(a,h)}),a.chart[b].tooltipContent(function(b,c,d,e,f){var g="<h3>"+b+"</h3>";return a.paragraph.config.graph.scatter.size&&a.isValidSizeOption(a.paragraph.config.graph.scatter,a.paragraph.result.rows)&&(g+="<p>"+f.point.size+"</p>"),g}),a.chart[b].showDistX(!0).showDistY(!0)}else{var k=I(c);if("pieChart"===b){var l=J(k,!0).d3g;if(a.chart[b].x(function(a){return a.label}).y(function(a){return a.value}),l.length>0)for(var m=0;m<l[0].values.length;m++){var n=l[0].values[m];i.push({label:n.x,value:n.y})}}else if("multiBarChart"===b)i=J(k,!0,!1,b).d3g,a.chart[b].yAxis.axisLabelDistance(50),a.chart[b].yAxis.tickFormat(function(a){return D(a)});else if("lineChart"===b||"stackedAreaChart"===b||"lineWithFocusChart"===b){var o=J(k,!1,!0);f=o.xLabels,i=o.d3g,a.chart[b].xAxis.tickFormat(function(a){return C(a,f)}),"stackedAreaChart"===b?a.chart[b].yAxisTickFormat(function(a){return D(a)}):a.chart[b].yAxis.tickFormat(function(a){return D(a,f)}),a.chart[b].yAxis.axisLabelDistance(50),a.chart[b].useInteractiveGuideline&&a.chart[b].useInteractiveGuideline(!0),a.paragraph.config.graph.forceY?a.chart[b].forceY([0]):a.chart[b].forceY([])}}var p=function(){var c=a.paragraph.config.graph.height,d=300,e=150;try{i[0].values.length>e&&(d=0)}catch(a){}d3.select("#p"+a.paragraph.id+"_"+b+" svg").attr("height",a.paragraph.config.graph.height).datum(i).transition().duration(d).call(a.chart[b]),d3.select("#p"+a.paragraph.id+"_"+b+" svg").style.height=c+"px",nv.utils.windowResize(a.chart[b].update)},q=function(){if(0!==angular.element("#p"+a.paragraph.id+"_"+b+" svg").length)try{p()}catch(a){}else g(q,10)};g(q)},F=function(b,c){var d=function(b,c){o.require(["esri/layers/FeatureLayer"],function(d){for(var e=new d({id:"pins",spatialReference:a.map.spatialReference,geometryType:"point",source:b,fields:[],objectIdField:"_ObjectID",renderer:a.map.pinRenderer,popupTemplate:{title:"[{_lng}, {_lat}]",content:[{type:"fields",fieldInfos:[]}]}}),f=a.paragraph.config.graph.map.pinCols,g=0;g<f.length;++g)e.popupTemplate.content[0].fieldInfos.push({fieldName:f[g].name,visible:!0});c(e)})},e=function(c){o.require(["esri/geometry/Point"],function(d,e){var f=a.paragraph.config.graph.map.lat,g=a.paragraph.config.graph.map.lng,h=a.paragraph.config.graph.map.pinCols,i=[];if(f&&g&&b.rows)for(var j=0;j<b.rows.length;++j){for(var k=b.rows[j],l=k[g.index],m=k[f.index],n={geometry:new d({longitude:l,latitude:m,spatialReference:a.map.spatialReference}),attributes:{_ObjectID:j,_lng:l,_lat:m}},o=0;o<h.length;++o){var p=h[o];n.attributes[p.name]=k[p.index]}i.push(n)}c(i)})},f=function(){var b=a.map.map.findLayerById("pins");a.map.popup.close(),b&&a.map.map.remove(b),e(function(b){d(b,function(b){a.map.map.add(b),b.source.length>0&&a.map.goTo(b.source)})})},h=function(b){var c=function(a){var b=a||window.event;b.cancelBubble=!0,b.returnValue=!1,b.stopPropagation&&b.stopPropagation()},d=window.WheelEvent?"wheel":window.MouseWheelEvent?"mousewheel":"DOMMouseScroll";b.addEventListener(d,c,!0),o.require(["esri/views/MapView","esri/Map","esri/renderers/SimpleRenderer","esri/symbols/SimpleMarkerSymbol"],function(c,d,e,g){a.map=new c({container:b,map:new d({basemap:a.paragraph.config.graph.map.baseMapType.toLowerCase()}),center:[-106.3468,56.1304],zoom:2,pinRenderer:new e({symbol:new g({color:[255,0,0,.5],size:16.5,outline:{color:[0,0,0,1],width:1.125},path:"M16,3.5c-4.142,0-7.5,3.358-7.5,7.5c0,4.143,7.5,18.121,7.5,18.121S23.5,15.143,23.5,11C23.5,6.858,20.143,3.5,16,3.5z M16,14.584c-1.979,0-3.584-1.604-3.584-3.584S14.021,7.416,16,7.416S19.584,9.021,19.584,11S17.979,14.584,16,14.584z"})})}),a.map.on("click",function(){a.map.popup.selectedFeature&&(a.map.popup.location=a.map.popup.selectedFeature.geometry)}),a.map.then(f)})},j=function(b){var c=function(c){var d=c.status>0;a.paragraph.config.graph.map.isOnline=d,b(d)};i.head("//services.arcgisonline.com/arcgis/",{timeout:5e3,withCredentials:!1}).then(c,c)},k=function(){var b=angular.element("#p"+a.paragraph.id+"_map").css("height",a.paragraph.config.graph.height).children("div").get(0);a.map&&!c&&(a.map.map.destroy(),a.map.pinRenderer=null,a.map=null);var d=function(){var a="//js.arcgis.com/4.0/esri/css/main.css";if(!angular.element('link[href="'+a+'"]').length){var b=document.createElement("link");b.rel="stylesheet",b.type="text/css",b.href=a,angular.element("head").append(b)}},e=function(a){o.isLoaded()?a():o.bootstrap({url:"//js.arcgis.com/4.0"}).then(a)};j(function(c){c&&(a.map?f():(d(),e(function(){h(b)})))})},l=function(){if(angular.element("#p"+a.paragraph.id+"_map div").length)try{k()}catch(a){}else g(l,10)};g(l)};a.setMapBaseMap=function(b){a.paragraph.config.graph.map.baseMapType=b,a.map&&(a.map.map.basemap=b.toLowerCase())},a.isGraphMode=function(b){var c=_.get(a.paragraph.config,"helium.activeApp");return"TABLE"===a.getResultType()&&a.getGraphMode()===b&&!c},a.onGraphOptionChange=function(){G(),a.setGraphMode(a.paragraph.config.graph.mode,!0,!1)},a.removeGraphOptionKeys=function(b){a.paragraph.config.graph.keys.splice(b,1),G(),a.setGraphMode(a.paragraph.config.graph.mode,!0,!1)},a.removeGraphOptionValues=function(b){a.paragraph.config.graph.values.splice(b,1),G(),a.setGraphMode(a.paragraph.config.graph.mode,!0,!1)},a.removeGraphOptionGroups=function(b){a.paragraph.config.graph.groups.splice(b,1),G(),a.setGraphMode(a.paragraph.config.graph.mode,!0,!1)},a.setGraphOptionValueAggr=function(b,c){a.paragraph.config.graph.values[b].aggr=c,G(),a.setGraphMode(a.paragraph.config.graph.mode,!0,!1)},a.removeScatterOptionXaxis=function(b){a.paragraph.config.graph.scatter.xAxis=null,G(),a.setGraphMode(a.paragraph.config.graph.mode,!0,!1)},a.removeScatterOptionYaxis=function(b){a.paragraph.config.graph.scatter.yAxis=null,G(),a.setGraphMode(a.paragraph.config.graph.mode,!0,!1)},a.removeScatterOptionGroup=function(b){a.paragraph.config.graph.scatter.group=null,G(),a.setGraphMode(a.paragraph.config.graph.mode,!0,!1)},a.removeScatterOptionSize=function(b){a.paragraph.config.graph.scatter.size=null,G(),a.setGraphMode(a.paragraph.config.graph.mode,!0,!1)},a.removeMapOptionLat=function(b){a.paragraph.config.graph.map.lat=null,G(),a.setGraphMode(a.paragraph.config.graph.mode,!0,!1)},a.removeMapOptionLng=function(b){a.paragraph.config.graph.map.lng=null,G(),a.setGraphMode(a.paragraph.config.graph.mode,!0,!1)},a.removeMapOptionPinInfo=function(b){a.paragraph.config.graph.map.pinCols.splice(b,1),G(),a.setGraphMode(a.paragraph.config.graph.mode,!0,!1)};var G=function(){var b=function(a){for(var b=0;b<a.length;b++)for(var c=b+1;c<a.length;c++)angular.equals(a[b],a[c])&&a.splice(c,1)},c=function(b){for(var c=0;c<b.length;c++){for(var d=!1,e=0;e<a.paragraph.result.columnNames.length;e++){var f=b[c],g=a.paragraph.result.columnNames[e];if(f.index===g.index&&f.name===g.name){d=!0;break}}d||b.splice(c,1)}},d=function(b){for(var c in b)if(b[c]){for(var d=!1,e=0;e<a.paragraph.result.columnNames.length;e++){var f=b[c],g=a.paragraph.result.columnNames[e];if(f.index===g.index&&f.name===g.name){d=!0;break}}d||!(b[c]instanceof Object)||b[c]instanceof Array||(b[c]=null)}};b(a.paragraph.config.graph.keys),c(a.paragraph.config.graph.keys),c(a.paragraph.config.graph.values),b(a.paragraph.config.graph.groups),c(a.paragraph.config.graph.groups),d(a.paragraph.config.graph.scatter),b(a.paragraph.config.graph.map.pinCols),c(a.paragraph.config.graph.map.pinCols),d(a.paragraph.config.graph.map)},H=function(){0===a.paragraph.config.graph.keys.length&&a.paragraph.result.columnNames.length>0&&a.paragraph.config.graph.keys.push(a.paragraph.result.columnNames[0]),0===a.paragraph.config.graph.values.length&&a.paragraph.result.columnNames.length>1&&a.paragraph.config.graph.values.push(a.paragraph.result.columnNames[1]),a.paragraph.config.graph.scatter.xAxis||a.paragraph.config.graph.scatter.yAxis||(a.paragraph.result.columnNames.length>1?(a.paragraph.config.graph.scatter.xAxis=a.paragraph.result.columnNames[0],a.paragraph.config.graph.scatter.yAxis=a.paragraph.result.columnNames[1]):1===a.paragraph.result.columnNames.length&&(a.paragraph.config.graph.scatter.xAxis=a.paragraph.result.columnNames[0]));var b=function(b,c){var d;if(!a.paragraph.config.graph.map[b])for(var e=0;e<a.paragraph.result.columnNames.length;++e)if(d=a.paragraph.result.columnNames[e],d.name.toUpperCase().indexOf(c)!==-1){a.paragraph.config.graph.map[b]=d;break}};b("lat","LAT"),b("lng","LONG")},I=function(b){for(var c=a.paragraph.config.graph.keys,d=a.paragraph.config.graph.groups,e=a.paragraph.config.graph.values,f={sum:function(a,b){var c=void 0!==a?isNaN(a)?1:parseFloat(a):0,d=void 0!==b?isNaN(b)?1:parseFloat(b):0;return c+d},count:function(a,b){var c=void 0!==a?parseInt(a):0,d=void 0!==b?1:0;return c+d},min:function(a,b){var c=void 0!==a?isNaN(a)?1:parseFloat(a):0,d=void 0!==b?isNaN(b)?1:parseFloat(b):0;return Math.min(c,d)},max:function(a,b){var c=void 0!==a?isNaN(a)?1:parseFloat(a):0,d=void 0!==b?isNaN(b)?1:parseFloat(b):0;return Math.max(c,d)},avg:function(a,b,c){var d=void 0!==a?isNaN(a)?1:parseFloat(a):0,e=void 0!==b?isNaN(b)?1:parseFloat(b):0;return d+e}},g={sum:!1,count:!1,min:!1,max:!1,avg:!0},h={},i={},j=0;j<b.rows.length;j++){for(var k=b.rows[j],l=h,m=i,n=0;n<c.length;n++){var o=c[n];l[o.name]||(l[o.name]={order:n,index:o.index,type:"key",children:{}}),l=l[o.name].children;var p=k[o.index];m[p]||(m[p]={}),m=m[p]}for(var q=0;q<d.length;q++){var r=d[q],s=k[r.index];l[s]||(l[s]={order:q,index:r.index,type:"group",children:{}}),l=l[s].children,m[s]||(m[s]={}),m=m[s]}for(var t=0;t<e.length;t++){var u=e[t],v=u.name+"("+u.aggr+")";l[v]||(l[v]={type:"value",order:t,index:u.index}),m[v]?m[v]={value:f[u.aggr](m[v].value,k[u.index],m[v].count+1),count:g[u.aggr]?m[v].count+1:m[v].count}:m[v]={value:"count"!==u.aggr?k[u.index]:1,count:1}}}return{schema:h,rows:i}},J=function(b,c,d,e){var f=[],g=b.schema,h=b.rows,i=a.paragraph.config.graph.values,j=function(a,b){return a?a+"."+b:b},k=function(a,b){for(var c in a.children)b[c]={},k(a.children[c],b[c])},l=function(a,b,c,e,f,g,h,i){"key"===b.type?(g=j(g,a),h=j(h,c)):"group"===b.type?i=j(i,c):("value"===b.type&&a===c||o)&&(i=j(i,c),f(g,h,i,e));for(var m in b.children)if(d&&"group"===b.children[m].type&&void 0===e[m]){var n={};k(b.children[m],n),l(m,b.children[m],m,n,f,g,h,i)}else for(var p in e)"key"!==b.children[m].type&&m!==p||l(m,b.children[m],p,e[p],f,g,h,i)},m=a.paragraph.config.graph.keys,n=a.paragraph.config.graph.groups;i=a.paragraph.config.graph.values;var o=0===m.length&&0===n.length&&i.length>0,p=0===m.length,q="multiBarChart"===e,r=Object.keys(g)[0],s={},t=0,u={},v=0,w={};for(var x in h)l(r,g[r],x,h[x],function(a,b,d,e){void 0===s[b]&&(w[t]=b,s[b]=t++),void 0===u[d]&&(u[d]=v++);var g=u[d];p&&q&&(g=0),f[g]||(f[g]={values:[],key:p&&q?"values":d});var h=isNaN(b)?c?b:s[b]:parseFloat(b),i=0;void 0===h&&(h=d),void 0!==e&&(i=isNaN(e.value)?0:parseFloat(e.value)/parseFloat(e.count)),f[g].values.push({x:h,y:i})});var y,z,A={};for(y in u)z=y.substring(0,y.lastIndexOf("(")),A[z]?A[z]++:A[z]=1;if(o)for(var B=0;B<f[0].values.length;B++)y=f[0].values[B].x,y&&(z=y.substring(0,y.lastIndexOf("(")),A[z]<=1&&(f[0].values[B].x=z));else{for(var C=0;C<f.length;C++)y=f[C].key,z=y.substring(0,y.lastIndexOf("(")),A[z]<=1&&(f[C].key=z);if(1===n.length&&1===i.length)for(C=0;C<f.length;C++)y=f[C].key,y=y.split(".").slice(0,-1).join("."),f[C].key=y}return{xLabels:w,d3g:f}},K=function(b){for(var c,d,e,f=a.paragraph.config.graph.scatter.xAxis,g=a.paragraph.config.graph.scatter.yAxis,h=a.paragraph.config.graph.scatter.group,i={},j=0;j<b.rows.length;j++){var k=b.rows[j];f&&(c=k[f.index]),g&&(d=k[g.index]),h&&(e=k[h.index]);var l=c+","+d+","+e;i[l]?i[l].size++:i[l]={x:c,y:d,group:e,size:1}}var m=[];for(var n in i){var o=[];f&&(o[f.index]=i[n].x),g&&(o[g.index]=i[n].y),h&&(o[h.index]=i[n].group),o[b.rows[0].length]=i[n].size,m.push(o)}return m},L=function(b,c){var d,e,f,g=a.paragraph.config.graph.scatter.xAxis,h=a.paragraph.config.graph.scatter.yAxis,i=a.paragraph.config.graph.scatter.group,j=a.paragraph.config.graph.scatter.size,k=[],l=[],m={},n=[],o={},p={},q={},r={},s={},t={},u=0,v=0,w=0,x="";if(!g&&!h)return{d3g:[]};for(var y=0;y<b.rows.length;y++)f=b.rows[y],g&&(d=f[g.index],k[y]=d),h&&(e=f[h.index],l[y]=e);var z=g&&h&&M(k)&&M(l)||!g&&M(l)||!h&&M(k);for(m=z?K(b):b.rows,!i&&z?x="count":i||j?!i&&j&&(x=j.name):g&&h?x="("+g.name+", "+h.name+")":g&&!h?x=g.name:!g&&h&&(x=h.name),y=0;y<m.length;y++){f=m[y],g&&(d=f[g.index]),h&&(e=f[h.index]),i&&(x=f[i.index]);var A=z?f[f.length-1]:j?f[j.index]:1;void 0===q[x]&&(t[w]=x,q[x]=w++),g&&void 0===o[d]&&(r[u]=d,o[d]=u++),h&&void 0===p[e]&&(s[v]=e,p[e]=v++),n[q[x]]||(n[q[x]]={key:x,values:[]}),n[q[x]].values.push({x:g?isNaN(d)?o[d]:parseFloat(d):0,y:h?isNaN(e)?p[e]:parseFloat(e):0,size:isNaN(parseFloat(A))?1:parseFloat(A)})}return{xLabels:r,yLabels:s,d3g:n}},M=function(a){for(var b=function(a){for(var b={},c=[],d=0,e=0;e<a.length;e++){var f=a[e];1!==b[f]&&(b[f]=1,c[d++]=f)}return c},c=0;c<a.length;c++)if(isNaN(parseFloat(a[c]))&&("string"==typeof a[c]||a[c]instanceof String))return!0;var d=.05,e=b(a);return e.length/a.length<d};a.isValidSizeOption=function(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e],g=f[a.size.index];if(isNaN(parseFloat(g))||!isFinite(g))return!1;if(a.xAxis){var h=f[a.xAxis.index];c[e]=h}if(a.yAxis){var i=f[a.yAxis.index];d[e]=i}}var j=a.xAxis&&a.yAxis&&M(c)&&M(d)||!a.xAxis&&M(d)||!a.yAxis&&M(c);return!j},a.resizeParagraph=function(b,c){a.changeColWidth(b),g(function(){w(a.paragraph.id+"_editor"),a.changeHeight(c)},200)},a.changeHeight=function(b){var c=angular.copy(a.paragraph.settings.params),d=angular.copy(a.paragraph.config);d.graph.height=b,y(a.paragraph.title,a.paragraph.text,d,c)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)===a}),a.goToSingleParagraph=function(){var b=c.current.pathParams.noteId,e=location.protocol+"//"+location.host+location.pathname+"#/notebook/"+b+"/paragraph/"+a.paragraph.id+"?asIframe";d.open(e)},a.showScrollDownIcon=function(){var b=angular.element("#p"+a.paragraph.id+"_text");return!!b[0]&&b[0].scrollHeight>b.innerHeight()},a.scrollParagraphDown=function(){var b=angular.element("#p"+a.paragraph.id+"_text");b.animate({scrollTop:b[0].scrollHeight},500),a.keepScrollDown=!0},a.showScrollUpIcon=function(){return!!angular.element("#p"+a.paragraph.id+"_text")[0]&&0!==angular.element("#p"+a.paragraph.id+"_text")[0].scrollTop},a.scrollParagraphUp=function(){var b=angular.element("#p"+a.paragraph.id+"_text");b.animate({scrollTop:0},500),a.keepScrollDown=!1},a.exportToDSV=function(b){var c="";for(var d in a.paragraph.result.columnNames)c+=a.paragraph.result.columnNames[d].name+b;c=c.substring(0,c.length-1)+"\n";for(var e in a.paragraph.result.msgTable){var f=a.paragraph.result.msgTable[e],g="";for(var h in f)g+=f[h].value+b;c+=g.substring(0,g.length-1)+"\n"}var i="";"\t"===b?i="tsv":","===b&&(i="csv"),n.saveAs(c,"data",i)},a.apps=[],a.suggestion={},a.switchApp=function(b){var c=a.paragraph.config,d=a.paragraph.settings,e=angular.copy(c),f=angular.copy(d.params);_.set(e,"helium.activeApp",b),N(e,f)},a.loadApp=function(b){var d=c.current.pathParams.noteId;i.post(l.getRestApiBase()+"/helium/load/"+d+"/"+a.paragraph.id,b).success(function(a,b,c,d){}).error(function(a,b,c,d){})};var N=function(b,c){var d=a.paragraph;y(d.title,d.text,b,c)},O=function(){var b=[],c=a.paragraph;c.apps&&_.forEach(c.apps,function(a){b.push({id:a.id,pkg:a.pkg,status:a.status,output:a.output})}),_.forEach(a.apps,function(c,d){var e=_.find(b,{id:c.id});e?angular.extend(a.apps[d],e):a.apps.splice(d,1)}),_.forEach(b,function(b,c){(a.apps.length<=c||a.apps[c].id!==b.id)&&a.apps.splice(c,0,b)})},P=function(){var b=c.current.pathParams.noteId;i.get(l.getRestApiBase()+"/helium/suggest/"+b+"/"+a.paragraph.id).success(function(b,c,d,e){a.suggestion=b.body}).error(function(a,b,c,d){})},Q=function(a){return a.scope||(a.scope=b.$new(!0,b)),a.scope},R=function(a){return a.registry||(a.registry={}),a.registry},S=function(a){var b=function(){var c=angular.element(document.getElementById("p"+a.id));if(c.length)try{c.html(a.output),h(c.contents())(Q(a))}catch(a){}else g(b,1e3)};g(b)};a.$on("appendAppOutput",function(b,c){if(a.paragraph.id===c.paragraphId){var d=_.find(a.apps,{id:c.appId});if(d){d.output+=c.data;var e=_.find(a.paragraph.apps,{id:c.appId});e.output=d.output;var f=angular.element(document.getElementById("p"+d.id));f.html(d.output),h(f.contents())(Q(d))}}}),a.$on("updateAppOutput",function(b,c){if(a.paragraph.id===c.paragraphId){var d=_.find(a.apps,{id:c.appId});if(d){d.output=c.data;var e=_.find(a.paragraph.apps,{id:c.appId});e.output=d.output;var f=angular.element(document.getElementById("p"+d.id));f.html(d.output),h(f.contents())(Q(d))}}}),a.$on("appLoad",function(b,c){if(a.paragraph.id===c.paragraphId){var d=_.find(a.apps,{id:c.appId});d||(d={id:c.appId,pkg:c.pkg,status:"UNLOADED",output:""},a.apps.push(d),a.paragraph.apps.push(d),a.switchApp(d.id))}}),a.$on("appStatusChange",function(b,c){if(a.paragraph.id===c.paragraphId){var d=_.find(a.apps,{id:c.appId});if(d){d.status=c.status;var e=_.find(a.paragraph.apps,{id:c.appId});e.status=d.status}}}),a.$on("angularObjectUpdate",function(b,d){var e=c.current.pathParams.noteId;
if(!d.noteId||d.noteId===e){var f,g;if(d.paragraphId&&d.paragraphId!==a.paragraph.id){var h=_.find(a.apps,{id:d.paragraphId});if(!h)return;f=Q(h),g=R(h)}else f=q,g=r;var i=d.angularObject.name;if(angular.equals(d.angularObject.object,f[i]))return;if(g[i]?(g[i].noteId=g[i].noteId||d.noteId,g[i].paragraphId=g[i].paragraphId||d.paragraphId):g[i]={interpreterGroupId:d.interpreterGroupId,noteId:d.noteId,paragraphId:d.paragraphId},g[i].skipEmit=!0,g[i].clearWatcher||(g[i].clearWatcher=f.$watch(i,function(a,b){return g[i].skipEmit?void(g[i].skipEmit=!1):void k.updateAngularObject(g[i].noteId,g[i].paragraphId,i,a,g[i].interpreterGroupId)})),f[i]=d.angularObject.object,i.startsWith(p)){var j=i.substring(p.length);f[j]=function(){f[i]=arguments}}}}),a.$on("angularObjectRemove",function(b,d){var e=c.current.pathParams.noteId;if(!d.noteId||d.noteId===e){var f,g;if(d.paragraphId&&d.paragraphId!==a.paragraph.id){var h=_.find(a.apps,{id:d.paragraphId});if(!h)return;f=Q(h),g=R(h)}else f=q,g=r;var i=d.name;if(g[i]&&(g[i].clearWatcher(),g[i]=void 0),f[i]=void 0,i.startsWith(p)){var j=i.substring(p.length);f[j]=void 0}}}),a.$on("updateParagraph",function(c,d){if(!(d.paragraph.id!==a.paragraph.id||d.paragraph.dateCreated===a.paragraph.dateCreated&&d.paragraph.dateFinished===a.paragraph.dateFinished&&d.paragraph.dateStarted===a.paragraph.dateStarted&&d.paragraph.dateUpdated===a.paragraph.dateUpdated&&d.paragraph.status===a.paragraph.status&&d.paragraph.jobName===a.paragraph.jobName&&d.paragraph.title===a.paragraph.title&&t(d.paragraph.result)===t(a.paragraph.result)&&d.paragraph.errorMessage===a.paragraph.errorMessage&&angular.equals(d.paragraph.settings,a.paragraph.settings)&&angular.equals(d.paragraph.config,a.paragraph.config))){var e=a.getResultType(),f=a.getResultType(d.paragraph),g=a.getGraphMode(),h=a.getGraphMode(d.paragraph),i=_.get(a.paragraph.config,"helium.activeApp"),j=_.get(d.paragraph.config,"helium.activeApp"),k=d.paragraph.status!==a.paragraph.status,l=d.paragraph.dateFinished!==a.paragraph.dateFinished||t(d.paragraph.result)!==t(a.paragraph.result)||"ERROR"===d.paragraph.status||"FINISHED"===d.paragraph.status&&k||!j&&i!==j;if(a.paragraph.text!==d.paragraph.text&&(a.dirtyText?a.dirtyText===d.paragraph.text?(a.paragraph.text=d.paragraph.text,a.dirtyText=void 0,a.originalText=angular.copy(d.paragraph.text)):a.paragraph.text=a.dirtyText:(a.paragraph.text=d.paragraph.text,a.originalText=angular.copy(d.paragraph.text))),a.paragraph.aborted=d.paragraph.aborted,a.paragraph.user=d.paragraph.user,a.paragraph.dateUpdated=d.paragraph.dateUpdated,a.paragraph.dateCreated=d.paragraph.dateCreated,a.paragraph.dateFinished=d.paragraph.dateFinished,a.paragraph.dateStarted=d.paragraph.dateStarted,a.paragraph.errorMessage=d.paragraph.errorMessage,a.paragraph.jobName=d.paragraph.jobName,a.paragraph.title=d.paragraph.title,a.paragraph.lineNumbers=d.paragraph.lineNumbers,a.paragraph.status=d.paragraph.status,a.paragraph.result=d.paragraph.result,a.paragraph.settings=d.paragraph.settings,a.editor.setReadOnly(a.isRunning()),a.asIframe?(d.paragraph.config.editorHide=!0,d.paragraph.config.tableHide=!1,a.paragraph.config=d.paragraph.config):(a.paragraph.config=d.paragraph.config,s()),"TABLE"===f?(a.loadTableData(a.paragraph.result),("TABLE"!==e||l)&&(G(),H()),g!==h?a.setGraphMode(h,!1,!1):a.setGraphMode(h,!1,!0)):"HTML"===f&&l?a.renderHtml():"ANGULAR"===f&&l?a.renderAngular():"TEXT"===f&&l&&a.renderText(),O(),P(),j&&j!==i){var m=_.find(a.apps,{id:j});S(m)}if(k||l){var n=angular.element('div[id$="_paragraphColumn_main"]');n.length>=2&&n[n.length-2].id.startsWith(a.paragraph.id)&&setTimeout(function(){b.$broadcast("scrollToCursor")},500)}}}),a.$on("appendParagraphOutput",function(b,c){a.paragraph.id!==c.paragraphId||"RUNNING"!==a.paragraph.status&&"PENDING"!==a.paragraph.status||(a.flushStreamingOutput&&(a.clearTextOutput(),a.flushStreamingOutput=!1),a.appendTextOutput(c.data))}),a.$on("updateParagraphOutput",function(b,c){a.paragraph.id===c.paragraphId&&(a.clearTextOutput(),a.appendTextOutput(c.data))}),a.$on("updateProgress",function(b,c){c.id===a.paragraph.id&&(a.currentProgress=c.progress)}),a.$on("keyEvent",function(b,c){if(a.paragraphFocused){var d=a.paragraph.id,e=c.keyCode,f=!1,g=a.paragraph.config.editorHide;g&&(38===e||80===e&&c.ctrlKey&&!c.altKey)?a.$emit("moveFocusToPreviousParagraph",d):g&&(40===e||78===e&&c.ctrlKey&&!c.altKey)?a.$emit("moveFocusToNextParagraph",d):c.shiftKey&&13===e?a.run():c.ctrlKey&&c.altKey&&67===e?a.cancelParagraph():c.ctrlKey&&c.altKey&&68===e?a.removeParagraph():c.ctrlKey&&c.altKey&&75===e?a.moveUp():c.ctrlKey&&c.altKey&&74===e?a.moveDown():c.ctrlKey&&c.altKey&&65===e?a.insertNew("above"):c.ctrlKey&&c.altKey&&66===e?a.insertNew("below"):c.ctrlKey&&c.altKey&&79===e?a.toggleOutput():c.ctrlKey&&c.altKey&&82===e?a.toggleEnableDisable():c.ctrlKey&&c.altKey&&69===e?a.toggleEditor():c.ctrlKey&&c.altKey&&77===e?a.paragraph.config.lineNumbers?a.hideLineNumbers():a.showLineNumbers():c.ctrlKey&&c.shiftKey&&189===e?a.changeColWidth(Math.max(1,a.paragraph.config.colWidth-1)):c.ctrlKey&&c.shiftKey&&187===e?a.changeColWidth(Math.min(12,a.paragraph.config.colWidth+1)):c.ctrlKey&&c.altKey&&84===e?a.paragraph.config.title?a.hideTitle():a.showTitle():f=!0,f||c.preventDefault()}}),a.$on("focusParagraph",function(b,c,d,e){if(a.paragraph.id===c){if(!a.paragraph.config.editorHide&&!e){a.editor.focus();var f;d>=0?(f=d,a.editor.gotoLine(f,0)):(f=a.editor.session.getLength(),a.editor.gotoLine(f,0)),a.scrollToCursor(a.paragraph.id,0)}a.handleFocus(!0)}else{a.editor.blur();var g=!0;a.handleFocus(!1,g)}}),a.$on("runParagraph",function(b){a.runParagraph(a.editor.getValue())}),a.$on("openEditor",function(b){a.openEditor()}),a.$on("closeEditor",function(b){a.closeEditor()}),a.$on("openTable",function(b){a.openTable()}),a.$on("closeTable",function(b){a.closeTable()})}]),angular.module("zeppelinWebApp").controller("SearchResultCtrl",["$scope","$routeParams","searchService",function(a,b,c){a.isResult=!0,a.searchTerm=b.searchTerm;var d=c.search({q:b.searchTerm}).query();d.$promise.then(function(d){a.notes=d.body.map(function(a){return/\/paragraph\//.test(a.id)?(a.id=a.id.replace("paragraph/","?paragraph=")+"&term="+b.searchTerm,a):a}),0===a.notes.length?a.isResult=!1:a.isResult=!0,a.$on("$routeChangeStart",function(a,b,d){"/search/:searchTerm"!==b.originalPath&&(c.searchTerm="")})}),a.page=0,a.allResults=!1,a.highlightSearchResults=function(a){return function(b){function c(a){var b={"ace/mode/scala":/^%(\w*\.)?spark/,"ace/mode/python":/^%(\w*\.)?(pyspark|python)/,"ace/mode/r":/^%(\w*\.)?(r|sparkr|knitr)/,"ace/mode/sql":/^%(\w*\.)?\wql/,"ace/mode/markdown":/^%md/,"ace/mode/sh":/^%sh/};return Object.keys(b).reduce(function(c,d){return b[d].test(a)?d:c},"ace/mode/scala")}function d(a){return function(b){for(var c=[],d=-1;(d=b.indexOf(a,d+1))>=0;)c.push(d);return c}}var e=ace.require("ace/range").Range;b.setOption("highlightActiveLine",!1),b.$blockScrolling=1/0,b.setReadOnly(!0),b.renderer.setShowGutter(!1),b.setTheme("ace/theme/chrome"),b.getSession().setMode(c(a.text));var f="";f=""!==a.header?a.header+"\n\n"+a.snippet:a.snippet;var g=f.split("\n").map(function(c,f){var g=c.match(/<B>(.+?)<\/B>/);if(!g)return c;var h=g[1],i=c.replace(/<B>/g,"").replace(/<\/B>/g,""),j=d(h)(i);return j.forEach(function(d){var g=d+h.length;""!==a.header&&0===f?(b.getSession().addMarker(new e(f,0,f,c.length),"search-results-highlight-header","background"),b.getSession().addMarker(new e(f,d,f,g),"search-results-highlight","line")):b.getSession().addMarker(new e(f,d,f,g),"search-results-highlight","line")}),i});b.setOption("maxLines",g.reduce(function(a,b){return a+b.length},0)),b.getSession().setValue(g.join("\n"))}}}]),angular.module("zeppelinWebApp").service("arrayOrderingSrv",function(){var a=this;this.notebookListOrdering=function(b){return a.getNoteName(b)},this.getNoteName=function(a){return void 0===a.name||""===a.name.trim()?"Note "+a.id:a.name}}),angular.module("zeppelinWebApp").controller("NavCtrl",["$scope","$rootScope","$http","$routeParams","$location","notebookListDataFactory","baseUrlSrv","websocketMsgSrv","arrayOrderingSrv","searchService",function(a,b,c,d,e,f,g,h,i,j){function k(){c.get(g.getRestApiBase()+"/version").success(function(a,c,d,e){b.zeppelinVersion=a.body}).error(function(a,b,c,d){})}function l(){angular.element("#notebook-list").perfectScrollbar({suppressScrollX:!0}),angular.element(document).click(function(){a.query.q=""}),k(),n()}function m(a){return d.noteId===a}function n(){h.getNotebookList()}function o(){var a=g.getRestApiBase()+"/login/logout";a=a.replace("//","//false:false@"),c.post(a).error(function(){c.post(a).error(function(){b.userName="",b.ticket.principal="",b.ticket.ticket="",b.ticket.roles="",BootstrapDialog.show({message:"Logout Success"}),setTimeout(function(){window.location.replace("/")},1e3)})})}function p(a){e.path("/search/"+a)}function q(){setTimeout(function(){angular.element("#userName").focus()},500)}var r=this;r.arrayOrderingSrv=i,r.connected=h.isConnected(),r.isActive=m,r.logout=o,r.notes=f,r.search=p,r.searchForm=j,r.showLoginWindow=q,a.query={q:""},l(),a.$on("setNoteMenu",function(a,b){f.setNotes(b)}),a.$on("setConnectedStatus",function(a,b){r.connected=b}),a.$on("loginSuccess",function(a,b){n()})}]),angular.module("zeppelinWebApp").directive("ngEscape",function(){return function(a,b,c){b.bind("keydown keyup",function(b){27===b.which&&(a.$apply(function(){a.$eval(c.ngEscape)}),b.preventDefault())})}}),angular.module("zeppelinWebApp").directive("interpreterDirective",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){b.$last===!0&&a(function(){var a="ngRenderFinished";b.$emit(a)})}}}]),angular.module("zeppelinWebApp").directive("expandCollapse",function(){return{restrict:"EA",link:function(a,b,c){angular.element(b).click(function(a){angular.element(b).find(".expandable:visible").length>1?(angular.element(b).find(".expandable:visible").slideUp("slow"),angular.element(b).find("i.icon-folder-alt").toggleClass("icon-folder icon-folder-alt")):angular.element(b).find(".expandable").first().slideToggle("200",function(){angular.element(b).find("i").first().toggleClass("icon-folder icon-folder-alt")}),a.stopPropagation()})}}}),angular.module("zeppelinWebApp").controller("NotenameCtrl",["$scope","notebookListDataFactory","$routeParams","websocketMsgSrv",function(a,b,c,d){var e=this;e.clone=!1,e.notes=b,e.websocketMsgSrv=d,a.note={},e.createNote=function(){if(e.clone){var b=c.noteId;e.websocketMsgSrv.cloneNotebook(b,a.note.notename)}else e.websocketMsgSrv.createNotebook(a.note.notename)},e.handleNameEnter=function(){angular.element("#noteNameModal").modal("toggle"),e.createNote()},e.preVisible=function(b){a.note.notename=e.newNoteName(),e.clone=b,a.$apply()},e.newNoteName=function(){var a=1;return angular.forEach(e.notes.flatList,function(b){if(b=b.name,b.match(/^Untitled Note [0-9]*$/)){var c=1*b.substr(14);a<=c&&(a=c+1)}}),"Untitled Note "+a}}]),angular.module("zeppelinWebApp").controller("NoteImportCtrl",["$scope","$timeout","websocketMsgSrv",function(a,b,c){var d=this;a.note={},a.note.step1=!0,a.note.step2=!1,d.resetFlags=function(){a.note={},a.note.step1=!0,a.note.step2=!1,angular.element("#noteImportFile").val("")},a.uploadFile=function(){angular.element("#noteImportFile").click()},a.importFile=function(b){a.note.errorText="",a.note.importFile=b.files[0];var c=a.note.importFile,e=new FileReader;e.onloadend=function(){d.processImportJson(e.result)},c&&e.readAsText(c)},a.uploadURL=function(){a.note.errorText="",a.note.step1=!1,b(function(){a.note.step2=!0},400)},d.importBack=function(){a.note.errorText="",b(function(){a.note.step1=!0},400),a.note.step2=!1},d.importNote=function(){a.note.errorText="",a.note.importUrl?jQuery.getJSON(a.note.importUrl,function(a){d.processImportJson(a)}).fail(function(){a.note.errorText="Unable to Fetch URL",a.$apply()}):(a.note.errorText="Enter URL",a.$apply())},d.processImportJson=function(b){if("object"!=typeof b)try{b=JSON.parse(b)}catch(b){return a.note.errorText="JSON parse exception",void a.$apply()}b.paragraphs&&b.paragraphs.length>0?(a.note.noteImportName?b.name=a.note.noteImportName:a.note.noteImportName=b.name,c.importNotebook(b)):a.note.errorText="Invalid JSON",a.$apply()},a.$on("setNoteMenu",function(a,b){d.resetFlags(),angular.element("#noteImportModal").modal("hide")})}]),angular.module("zeppelinWebApp").directive("popoverHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"components/popover-html-unsafe/popover-html-unsafe-popup.html"}}).directive("popoverHtmlUnsafe",["$tooltip",function(a){return a("popoverHtmlUnsafe","popover","click")}]),angular.module("zeppelinWebApp").directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(b.shiftKey||a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}),angular.module("zeppelinWebApp").directive("dropdownInput",function(){return{restrict:"A",link:function(a,b){b.bind("click",function(a){a.stopPropagation()})}}}),angular.module("zeppelinWebApp").directive("resizable",function(){var a={autoHide:!0,handles:"se",helper:"resizable-helper",stop:function(){angular.element(this).css({width:"100%",height:"100%"})}};return{restrict:"A",scope:{callback:"&onResize"},link:function(b,c,d){d.$observe("resize",function(d){var e=function(c,d){var e=window.innerWidth/12;c.off("resizestop");var f=angular.copy(a);"TABLE"===d.graphType||"TEXT"===d.graphType?(f.grid=[e,10],f.minHeight=100):(f.grid=[e,1e4],f.minHeight=0),f.maxWidth=window.innerWidth,c.resizable(f),c.on("resizestop",function(){if(b.callback){var a=c.height();a<50&&(a=300),b.callback({width:Math.ceil(c.width()/e),height:a})}})};d=JSON.parse(d),"true"===d.allowresize&&(e(c,d),angular.element(window).resize(function(){e(c,d)}))})}}}),angular.module("zeppelinWebApp").directive("modalvisible",function(){return{restrict:"A",scope:{preVisibleCallback:"&previsiblecallback",postVisibleCallback:"&postvisiblecallback",targetinput:"@targetinput"},link:function(a,b,c){var d=a.preVisibleCallback,e=a.postVisibleCallback;b.on("show.bs.modal",function(a){var b=angular.element(a.relatedTarget),c=b.data("clone"),e=!!c;d()(e)}),b.on("shown.bs.modal",function(b){a.targetinput&&angular.element(b.target).find("input#"+a.targetinput).select(),e()})}}}),angular.module("zeppelinWebApp").service("websocketMsgSrv",["$rootScope","websocketEvents",function(a,b){return{getHomeNotebook:function(){b.sendNewEvent({op:"GET_HOME_NOTE"})},createNotebook:function(a){b.sendNewEvent({op:"NEW_NOTE",data:{name:a}})},deleteNotebook:function(a){b.sendNewEvent({op:"DEL_NOTE",data:{id:a}})},cloneNotebook:function(a,c){b.sendNewEvent({op:"CLONE_NOTE",data:{id:a,name:c}})},getNotebookList:function(){b.sendNewEvent({op:"LIST_NOTES"})},reloadAllNotesFromRepo:function(){b.sendNewEvent({op:"RELOAD_NOTES_FROM_REPO"})},getNotebook:function(a){b.sendNewEvent({op:"GET_NOTE",data:{id:a}})},updateNotebook:function(a,c,d){b.sendNewEvent({op:"NOTE_UPDATE",data:{id:a,name:c,config:d}})},moveParagraph:function(a,c){b.sendNewEvent({op:"MOVE_PARAGRAPH",data:{id:a,index:c}})},insertParagraph:function(a){b.sendNewEvent({op:"INSERT_PARAGRAPH",data:{index:a}})},updateAngularObject:function(a,c,d,e,f){b.sendNewEvent({op:"ANGULAR_OBJECT_UPDATED",data:{noteId:a,paragraphId:c,name:d,value:e,interpreterGroupId:f}})},clientBindAngularObject:function(a,c,d,e){b.sendNewEvent({op:"ANGULAR_OBJECT_CLIENT_BIND",data:{noteId:a,name:c,value:d,paragraphId:e}})},clientUnbindAngularObject:function(a,c,d){b.sendNewEvent({op:"ANGULAR_OBJECT_CLIENT_UNBIND",data:{noteId:a,name:c,paragraphId:d}})},cancelParagraphRun:function(a){b.sendNewEvent({op:"CANCEL_PARAGRAPH",data:{id:a}})},runParagraph:function(a,c,d,e,f){b.sendNewEvent({op:"RUN_PARAGRAPH",data:{id:a,title:c,paragraph:d,config:e,params:f}})},removeParagraph:function(a){b.sendNewEvent({op:"PARAGRAPH_REMOVE",data:{id:a}})},clearParagraphOutput:function(a){b.sendNewEvent({op:"PARAGRAPH_CLEAR_OUTPUT",data:{id:a}})},completion:function(a,c,d){b.sendNewEvent({op:"COMPLETION",data:{id:a,buf:c,cursor:d}})},commitParagraph:function(a,c,d,e,f){b.sendNewEvent({op:"COMMIT_PARAGRAPH",data:{id:a,title:c,paragraph:d,config:e,params:f}})},importNotebook:function(a){b.sendNewEvent({op:"IMPORT_NOTE",data:{notebook:a}})},checkpointNotebook:function(a,c){b.sendNewEvent({op:"CHECKPOINT_NOTEBOOK",data:{noteId:a,commitMessage:c}})},listRevisionHistory:function(a){b.sendNewEvent({op:"LIST_REVISION_HISTORY",data:{noteId:a}})},getNoteByRevision:function(a,c){b.sendNewEvent({op:"NOTE_REVISION",data:{noteId:a,revisionId:c}})},getEditorSetting:function(a){b.sendNewEvent({op:"EDITOR_SETTING",data:{magic:a}})},isConnected:function(){return b.isConnected()},getNotebookJobsList:function(){b.sendNewEvent({op:"LIST_NOTEBOOK_JOBS"})},getUpdateNotebookJobsList:function(a){b.sendNewEvent({op:"LIST_UPDATE_NOTEBOOK_JOBS",data:{lastUpdateUnixTime:1*a}})},unsubscribeJobManager:function(){b.sendNewEvent({op:"UNSUBSCRIBE_UPDATE_NOTEBOOK_JOBS"})},getInterpreterBindings:function(a){b.sendNewEvent({op:"GET_INTERPRETER_BINDINGS",data:{noteID:a}})},saveInterpreterBindings:function(a,c){b.sendNewEvent({op:"SAVE_INTERPRETER_BINDINGS",data:{noteID:a,selectedSettingIds:c}})}}}]),angular.module("zeppelinWebApp").factory("websocketEvents",["$rootScope","$websocket","$location","baseUrlSrv",function(a,b,c,d){var e={};return e.ws=b(d.getWebsocketUrl()),e.ws.reconnectIfNotNormalClose=!0,e.ws.onOpen(function(){a.$broadcast("setConnectedStatus",!0),setInterval(function(){e.sendNewEvent({op:"PING"})},1e4)}),e.sendNewEvent=function(b){void 0!==a.ticket?(b.principal=a.ticket.principal,b.ticket=a.ticket.ticket,b.roles=a.ticket.roles):(b.principal="",b.ticket="",b.roles=""),e.ws.send(JSON.stringify(b))},e.isConnected=function(){return 1===e.ws.socket.readyState},e.ws.onMessage(function(b){var d;b.data&&(d=angular.fromJson(b.data));var e=d.op,f=d.data;"NOTE"===e?a.$broadcast("setNoteContent",f.note):"NEW_NOTE"===e?c.path("/notebook/"+f.note.id):"NOTES_INFO"===e?a.$broadcast("setNoteMenu",f.notes):"LIST_NOTEBOOK_JOBS"===e?a.$broadcast("setNotebookJobs",f.notebookJobs):"LIST_UPDATE_NOTEBOOK_JOBS"===e?a.$broadcast("setUpdateNotebookJobs",f.notebookRunningJobs):"AUTH_INFO"===e?BootstrapDialog.show({closable:!1,closeByBackdrop:!1,closeByKeyboard:!1,title:"Insufficient privileges",message:f.info.toString(),buttons:[{label:"Login",action:function(a){a.close(),angular.element("#loginModal").modal({show:"true"})}},{label:"Cancel",action:function(a){a.close(),c.path("/")}}]}):"PARAGRAPH"===e?a.$broadcast("updateParagraph",f):"PARAGRAPH_APPEND_OUTPUT"===e?a.$broadcast("appendParagraphOutput",f):"PARAGRAPH_UPDATE_OUTPUT"===e?a.$broadcast("updateParagraphOutput",f):"PROGRESS"===e?a.$broadcast("updateProgress",f):"COMPLETION_LIST"===e?a.$broadcast("completionList",f):"EDITOR_SETTING"===e?a.$broadcast("editorSetting",f):"ANGULAR_OBJECT_UPDATE"===e?a.$broadcast("angularObjectUpdate",f):"ANGULAR_OBJECT_REMOVE"===e?a.$broadcast("angularObjectRemove",f):"APP_APPEND_OUTPUT"===e?a.$broadcast("appendAppOutput",f):"APP_UPDATE_OUTPUT"===e?a.$broadcast("updateAppOutput",f):"APP_LOAD"===e?a.$broadcast("appLoad",f):"APP_STATUS_CHANGE"===e?a.$broadcast("appStatusChange",f):"LIST_REVISION_HISTORY"===e?a.$broadcast("listRevisionHistory",f):"NOTE_REVISION"===e?a.$broadcast("noteRevision",f):"INTERPRETER_BINDINGS"===e&&a.$broadcast("interpreterBindings",f)}),e.ws.onError(function(b){a.$broadcast("setConnectedStatus",!1)}),e.ws.onClose(function(b){a.$broadcast("setConnectedStatus",!1)}),e}]),angular.module("zeppelinWebApp").factory("notebookListDataFactory",function(){var a={root:{children:[]},flatList:[],setNotes:function(c){a.flatList=angular.copy(c),a.root={children:[]},_.reduce(c,function(a,c){var d=c.name||c.id,e=d.match(/([^\/][^\/]*)/g);return b(a,e,c.id),a},a.root)}},b=function(a,c,d){if(1===c.length)a.children.push({name:c[0],id:d});else{var e=c.shift(),f=_.find(a.children,function(a){return a.name===e&&void 0!==a.children});if(void 0!==f)b(f,c,d);else{var g={name:e,hidden:!0,children:[]};a.children.push(g),b(g,c,d)}}};return a}),angular.module("zeppelinWebApp").service("baseUrlSrv",function(){this.getPort=function(){var a=Number(location.port);return a||(a=80,"https:"===location.protocol&&(a=443)),3333!==a&&9e3!==a||(a=8080),a},this.getWebsocketUrl=function(){var b="https:"===location.protocol?"wss:":"ws:";return b+"//"+location.hostname+":"+this.getPort()+a(location.pathname)+"/ws"},this.getRestApiBase=function(){return location.protocol+"//"+location.hostname+":"+this.getPort()+a(location.pathname)+"/api"};var a=function(a){return a.replace(/\/$/,"")}}),angular.module("zeppelinWebApp").service("browserDetectService",function(){this.detectIE=function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);var c=a.indexOf("Trident/");if(c>0){var d=a.indexOf("rv:");return parseInt(a.substring(d+3,a.indexOf(".",d)),10)}var e=a.indexOf("Edge/");return e>0&&parseInt(a.substring(e+5,a.indexOf(".",e)),10)}}),angular.module("zeppelinWebApp").service("saveAsService",["browserDetectService",function(a){this.saveAs=function(b,c,d){var e="\ufeff";if(a.detectIE()){angular.element("body").append('<iframe id="SaveAsId" style="display: none"></iframe>');var f=angular.element("body > iframe#SaveAsId")[0].contentWindow;b=e+b,f.document.open("text/json","replace"),f.document.write(b),f.document.close(),f.focus();var g=Date.now();f.document.execCommand("SaveAs",!1,c+"."+d);var h=Date.now();g===h&&f.document.execCommand("SaveAs",!0,c+".txt"),angular.element("body > iframe#SaveAsId").remove()}else{b="data:image/svg;charset=utf-8,"+e+encodeURIComponent(b),angular.element("body").append('<a id="SaveAsId"></a>');var i=angular.element("body > a#SaveAsId");i.attr("href",b),i.attr("download",c+"."+d),i.attr("target","_blank"),i[0].click(),i.remove()}}}]),angular.module("zeppelinWebApp").service("searchService",["$resource","baseUrlSrv",function(a,b){this.search=function(c){if(this.searchTerm=c.q,c.q){var d=window.encodeURIComponent(c.q);return a(b.getRestApiBase()+"/notebook/search?q="+d,{},{query:{method:"GET"}})}},this.searchTerm=""}]),angular.module("zeppelinWebApp").controller("LoginCtrl",["$scope","$rootScope","$http","$httpParamSerializer","baseUrlSrv",function(a,b,c,d,e){a.loginParams={},a.login=function(){c({method:"POST",url:e.getRestApiBase()+"/login",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:d({userName:a.loginParams.userName,password:a.loginParams.password})}).then(function(c){b.ticket=c.data.body,angular.element("#loginModal").modal("toggle"),b.$broadcast("loginSuccess",!0),b.userName=a.loginParams.userName},function(b){a.loginParams.errorText="The username and password that you entered don't match."})};var f=function(){a.loginParams={userName:"",password:""}};a.$on("initLoginValues",function(){f()})}]),angular.module("zeppelinWebApp").controller("ElasticInputCtrl",function(){var a=this;a.showEditor=!1});